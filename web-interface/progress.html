<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÄ≤Â∫¶Êü•Áúã - IS1AB CTF ÁÆ°ÁêÜ‰ªãÈù¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Â∞éËà™Âàó -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-shield-check"></i> IS1AB CTF ÁÆ°ÁêÜ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house"></i> È¶ñÈ†Å
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="create-challenge.html">
                            <i class="bi bi-plus-circle"></i> ÂâµÂª∫È°åÁõÆ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="progress.html">
                            <i class="bi bi-graph-up"></i> ÈÄ≤Â∫¶Êü•Áúã
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                            <i class="bi bi-arrow-clockwise"></i> Âà∑Êñ∞
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- È†ÅÈù¢Ê®ôÈ°å -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-6">
                    <i class="bi bi-graph-up text-primary"></i> ÈÄ≤Â∫¶ËøΩËπ§
                </h1>
                <p class="lead text-muted">Ë©≥Á¥∞ÁöÑÈ°åÁõÆÈñãÁôºÈÄ≤Â∫¶ÂíåÁµ±Ë®àË≥áË®ä</p>
            </div>
        </div>

        <!-- ÈÅéÊøæÂô® -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="row align-items-end">
                            <div class="col-md-3">
                                <label for="filterCategory" class="form-label">ÂàÜÈ°ûÁØ©ÈÅ∏</label>
                                <select class="form-select" id="filterCategory" onchange="applyFilters()">
                                    <option value="">ÊâÄÊúâÂàÜÈ°û</option>
                                    <option value="web">Web</option>
                                    <option value="pwn">Pwn</option>
                                    <option value="reverse">Reverse</option>
                                    <option value="crypto">Crypto</option>
                                    <option value="forensic">Forensic</option>
                                    <option value="misc">Misc</option>
                                    <option value="general">General</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filterStatus" class="form-label">ÁãÄÊÖãÁØ©ÈÅ∏</label>
                                <select class="form-select" id="filterStatus" onchange="applyFilters()">
                                    <option value="">ÊâÄÊúâÁãÄÊÖã</option>
                                    <option value="planning">Ë¶èÂäÉ‰∏≠</option>
                                    <option value="developing">ÈñãÁôº‰∏≠</option>
                                    <option value="testing">Ê∏¨Ë©¶‰∏≠</option>
                                    <option value="completed">Â∑≤ÂÆåÊàê</option>
                                    <option value="deployed">Â∑≤ÈÉ®ÁΩ≤</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="filterDifficulty" class="form-label">Èõ£Â∫¶ÁØ©ÈÅ∏</label>
                                <select class="form-select" id="filterDifficulty" onchange="applyFilters()">
                                    <option value="">ÊâÄÊúâÈõ£Â∫¶</option>
                                    <option value="baby">Baby</option>
                                    <option value="easy">Easy</option>
                                    <option value="middle">Middle</option>
                                    <option value="hard">Hard</option>
                                    <option value="impossible">Impossible</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="searchQuery" class="form-label">ÊêúÂ∞ã</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchQuery" placeholder="ÊêúÂ∞ãÈ°åÁõÆ..." onkeyup="applyFilters()">
                                    <button class="btn btn-outline-secondary" onclick="clearSearch()">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Áµ±Ë®àÊëòË¶Å -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-bar-chart"></i> ÈÄ≤Â∫¶Ê¶ÇË¶Ω</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col">
                                <div class="mb-2">
                                    <div class="fs-3 text-secondary">üìù</div>
                                    <div class="fw-bold fs-5" id="planningCount">-</div>
                                    <small class="text-muted">Ë¶èÂäÉ‰∏≠</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-2">
                                    <div class="fs-3 text-warning">üî®</div>
                                    <div class="fw-bold fs-5" id="developingCount">-</div>
                                    <small class="text-muted">ÈñãÁôº‰∏≠</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-2">
                                    <div class="fs-3 text-info">üß™</div>
                                    <div class="fw-bold fs-5" id="testingCount">-</div>
                                    <small class="text-muted">Ê∏¨Ë©¶‰∏≠</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-2">
                                    <div class="fs-3 text-success">‚úÖ</div>
                                    <div class="fw-bold fs-5" id="completedCount">-</div>
                                    <small class="text-muted">Â∑≤ÂÆåÊàê</small>
                                </div>
                            </div>
                            <div class="col">
                                <div class="mb-2">
                                    <div class="fs-3 text-primary">üöÄ</div>
                                    <div class="fw-bold fs-5" id="deployedCount">-</div>
                                    <small class="text-muted">Â∑≤ÈÉ®ÁΩ≤</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÈÄ≤Â∫¶Ê¢ù -->
                        <div class="mt-4">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Êï¥È´îÂÆåÊàêÂ∫¶</small>
                                <small id="overallProgress">0%</small>
                            </div>
                            <div class="progress">
                                <div id="progressBar" class="progress-bar bg-success" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-pie-chart"></i> È°ûÂûãÂàÜÂ∏É</h5>
                    </div>
                    <div class="card-body">
                        <div id="typeDistribution">
                            <!-- Â∞áÁî± JavaScript ÂãïÊÖãÂ°´ÂÖ• -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë©≥Á¥∞È°åÁõÆÂàóË°® -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-list"></i> È°åÁõÆË©≥Á¥∞ÂàóË°®
                            <span class="badge bg-secondary ms-2" id="totalChallengesCount">0</span>
                        </h5>
                        <div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeView('table')">
                                    <i class="bi bi-table"></i> Ë°®Ê†º
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm active" onclick="changeView('card')">
                                    <i class="bi bi-card-list"></i> Âç°Áâá
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Ë°®Ê†ºÊ™¢Ë¶ñ -->
                        <div id="tableView" class="d-none">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>È°åÁõÆ</th>
                                            <th>ÂàÜÈ°û</th>
                                            <th>Èõ£Â∫¶</th>
                                            <th>È°ûÂûã</th>
                                            <th>ÁãÄÊÖã</th>
                                            <th>‰ΩúËÄÖ</th>
                                            <th>ÂéüÂßãÁ¢º</th>
                                            <th>Êìç‰Ωú</th>
                                        </tr>
                                    </thead>
                                    <tbody id="challengeTableBody">
                                        <!-- Â∞áÁî± JavaScript ÂãïÊÖãÂ°´ÂÖ• -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Âç°ÁâáÊ™¢Ë¶ñ -->
                        <div id="cardView" class="p-3">
                            <div id="challengeCards" class="row">
                                <!-- Â∞áÁî± JavaScript ÂãïÊÖãÂ°´ÂÖ• -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂàÜÈ°ûÈÄ≤Â∫¶Áü©Èô£ -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-grid"></i> ÂàÜÈ°ûÈÄ≤Â∫¶Áü©Èô£</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-striped" id="progressTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 180px;">ÂàÜÈ°û</th>
                                        <th class="text-center">A</th>
                                        <th class="text-center">B</th>
                                        <th class="text-center">C</th>
                                        <th class="text-center">D</th>
                                        <th class="text-center">E</th>
                                        <th class="text-center">F</th>
                                    </tr>
                                </thead>
                                <tbody id="progressTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Âúñ‰æã -->
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6 class="mb-2">Âúñ‰æãË™™ÊòéÔºö</h6>
                            <div class="row small">
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>ÁãÄÊÖãÂúñÁ§∫Ôºö</strong></div>
                                    <div><span class="badge bg-secondary me-1">üìù</span> Ë¶èÂäÉ‰∏≠</div>
                                    <div><span class="badge bg-warning me-1">üî®</span> ÈñãÁôº‰∏≠</div>
                                    <div><span class="badge bg-info me-1">üß™</span> Ê∏¨Ë©¶‰∏≠</div>
                                    <div><span class="badge bg-success me-1">‚úÖ</span> Â∑≤ÂÆåÊàê</div>
                                    <div><span class="badge bg-primary me-1">üöÄ</span> Â∑≤ÈÉ®ÁΩ≤</div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>Èõ£Â∫¶ÈÖçËâ≤Ôºö</strong></div>
                                    <div><span class="badge bg-success me-1">üçº</span> Baby</div>
                                    <div><span class="badge bg-info me-1">‚≠ê</span> Easy</div>
                                    <div><span class="badge bg-warning me-1">‚≠ê‚≠ê</span> Middle</div>
                                    <div><span class="badge bg-danger me-1">‚≠ê‚≠ê‚≠ê</span> Hard</div>
                                    <div><span class="badge bg-dark me-1">üíÄ</span> Impossible</div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>ÂÖ∂‰ªñÔºö</strong></div>
                                    <div><span class="text-muted me-1">‚ö™</span> ÂæÖÂâµÂª∫È°åÁõÆ</div>
                                    <div><span class="text-muted me-1">‚¨ú</span> ‰∏çÈúÄË¶Å</div>
                                    <div class="mt-2 small text-muted">
                                        ÊØèÂÄãÂç°ÁâáÈ°ØÁ§∫Ôºö<br>
                                        ‚Ä¢ È°åÁõÆÂêçÁ®±<br>
                                        ‚Ä¢ ‰ΩúËÄÖ (üë§)<br>
                                        ‚Ä¢ Èõ£Â∫¶ (üéØ)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="api.js"></script>
    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let challengeData = {};
        let filteredChallenges = [];
        let currentView = 'card';
        let selectedChallenge = null;

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadProgressData();
            
            // Á∂ÅÂÆöÊñ∞Â¢ûÊèêÁ§∫Ë°®ÂñÆ‰∫ã‰ª∂
            const addHintForm = document.getElementById('addHintForm');
            if (addHintForm) {
                addHintForm.addEventListener('submit', addNewHint);
            }
        });

        // ËºâÂÖ•ÈÄ≤Â∫¶Ë≥áÊñô
        async function loadProgressData() {
            try {
                const progress = await api.getProgress();
                challengeData = progress;
                updateProgressSummary(progress.stats);
                updateTypeDistribution(progress.stats);
                loadProgressTable();
                updateChallengeList(progress.challenges);
            } catch (error) {
                console.error('ËºâÂÖ•ÈÄ≤Â∫¶Â§±Êïó:', error);
                showConnectionError();
            }
        }


        // Êõ¥Êñ∞ÈÄ≤Â∫¶ÊëòË¶Å
        function updateProgressSummary(stats) {
            document.getElementById('planningCount').textContent = stats.status_counts?.planning || 0;
            document.getElementById('developingCount').textContent = stats.status_counts?.developing || 0;
            document.getElementById('testingCount').textContent = stats.status_counts?.testing || 0;
            document.getElementById('completedCount').textContent = stats.status_counts?.completed || 0;
            document.getElementById('deployedCount').textContent = stats.status_counts?.deployed || 0;

            // Ë®àÁÆóÊï¥È´îÂÆåÊàêÂ∫¶
            const completed = (stats.status_counts?.completed || 0) + (stats.status_counts?.deployed || 0);
            const total = stats.total_challenges || 0;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('overallProgress').textContent = `${percentage}%`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        // Êõ¥Êñ∞È°ûÂûãÂàÜÂ∏É
        function updateTypeDistribution(stats) {
            const types = [
                { name: 'üìé ÈùúÊÖãÈôÑ‰ª∂', count: stats.type_counts?.static_attachment || 0, color: 'primary' },
                { name: 'üê≥ ÈùúÊÖãÂÆπÂô®', count: stats.type_counts?.static_container || 0, color: 'info' },
                { name: 'üìã ÂãïÊÖãÈôÑ‰ª∂', count: stats.type_counts?.dynamic_attachment || 0, color: 'warning' },
                { name: 'üîÑ ÂãïÊÖãÂÆπÂô®', count: stats.type_counts?.dynamic_container || 0, color: 'success' },
                { name: 'üîå NC È°åÁõÆ', count: stats.type_counts?.nc_challenge || 0, color: 'danger' }
            ];

            const total = types.reduce((sum, type) => sum + type.count, 0);
            
            let html = '';
            types.forEach(type => {
                const percentage = total > 0 ? Math.round((type.count / total) * 100) : 0;
                if (type.count > 0) {
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small">${type.name}</span>
                            <span class="badge bg-${type.color}">${type.count}</span>
                        </div>
                        <div class="progress mb-3" style="height: 8px;">
                            <div class="progress-bar bg-${type.color}" style="width: ${percentage}%"></div>
                        </div>
                    `;
                }
            });

            if (html === '') {
                html = '<p class="text-muted text-center">Êö´ÁÑ°Ë≥áÊñô</p>';
            }

            document.getElementById('typeDistribution').innerHTML = html;
        }

        // ÊèêÁ§∫ÁÆ°ÁêÜÂäüËÉΩÔºàÂæûÈ¶ñÈ†ÅË§áË£ΩÔºâ
        async function openHintsManager(rowIndex, cellIndex, title, category, folderName) {
            try {
                // Ë®≠ÁΩÆÁï∂ÂâçÈ°åÁõÆË≥áË®ä
                currentHintsChallenge = { category, folderName };
                
                // Ë®≠ÁΩÆÊ®°ÊÖãÊ°ÜÊ®ôÈ°å
                const titleElement = document.getElementById('hintsModalTitle');
                if (titleElement) {
                    titleElement.textContent = `${title} (${category})`;
                }
                
                // ËºâÂÖ•ÁèæÊúâÊèêÁ§∫
                await loadChallengeHints(category, folderName);
                
                // È°ØÁ§∫Ê®°ÊÖãÊ°Ü
                const modal = new bootstrap.Modal(document.getElementById('hintsModal'));
                modal.show();
            } catch (error) {
                showToast('ËºâÂÖ•Â§±Êïó', error.message, 'error');
            }
        }

        // Êñ∞Â¢ûÊèêÁ§∫Ë°®ÂñÆËôïÁêÜ
        async function addNewHint(event) {
            event.preventDefault();
            
            if (!currentHintsChallenge) {
                showToast('ÈåØË™§', 'ÁÑ°Ê≥ïÁç≤ÂèñÈ°åÁõÆË≥áË®ä', 'error');
                return;
            }
            
            const level = parseInt(document.getElementById('hintLevel').value);
            const cost = parseInt(document.getElementById('hintCost').value);
            const content = document.getElementById('hintContent').value;
            
            if (!level || !content) {
                showToast('ÈåØË™§', 'Ë´ãÂ°´ÂØ´ÂÆåÊï¥ÁöÑÊèêÁ§∫Ë≥áË®ä', 'error');
                return;
            }
            
            const hintData = { level, cost: cost || 0, content };
            
            try {
                const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hintData)
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Êñ∞Â¢ûÊèêÁ§∫Â§±Êïó');
                }
                
                showToast('ÊàêÂäü', 'ÊèêÁ§∫Êñ∞Â¢ûÊàêÂäü', 'success');
                
                // ÈáçÊñ∞ËºâÂÖ•ÊèêÁ§∫ÂàóË°®
                await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
                
                // ÈáçÁΩÆË°®ÂñÆ
                document.getElementById('addHintForm').reset();
            } catch (error) {
                showToast('Êñ∞Â¢ûÂ§±Êïó', error.message, 'error');
            }
        }

        // È°ØÁ§∫ÊèêÁ§∫ÂàóË°®
        function renderHints(hints) {
            const container = document.getElementById('existingHints');
            
            if (!container) {
                console.warn('existingHints container not found');
                return;
            }
            
            if (!hints || hints.length === 0) {
                container.innerHTML = `
                    <div class="list-group-item text-center text-muted">
                        <em>Â∞öÊú™Ë®≠ÂÆö‰ªª‰ΩïÊèêÁ§∫</em>
                    </div>
                `;
                return;
            }
            
            let html = '';
            hints.forEach(hint => {
                html += `
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-primary me-2">Level ${hint.level}</span>
                                    <small class="text-muted">${hint.cost} ÂàÜ</small>
                                </div>
                                <p class="mb-0">${hint.content}</p>
                            </div>
                            <div class="btn-group btn-group-sm" role="group">
                                <button type="button" class="btn btn-outline-warning" 
                                    onclick="editHint(${hint.level}, '${hint.content.replace(/'/g, "\\'")}', ${hint.cost})"
                                    title="Á∑®ËºØ">
                                    ‚úèÔ∏è
                                </button>
                                <button type="button" class="btn btn-outline-danger"
                                    onclick="deleteHint(${hint.level})"
                                    title="Âà™Èô§">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ÂÖ®ÂüüËÆäÊï∏Áî®ÊñºËøΩËπ§Áï∂ÂâçÊ≠£Âú®ÁÆ°ÁêÜÊèêÁ§∫ÁöÑÈ°åÁõÆ
        let currentHintsChallenge = null;

        // Á∑®ËºØÊèêÁ§∫
        function editHint(level, content, cost) {
            if (!document.getElementById('hintLevel')) {
                console.warn('Hint form elements not found');
                return;
            }
            
            document.getElementById('hintLevel').value = level;
            document.getElementById('hintCost').value = cost;
            document.getElementById('hintContent').value = content;
            
            // Êõ¥ÊîπÊåâÈàïÊñáÂ≠óÂíåË°åÁÇ∫
            const submitBtn = document.querySelector('#addHintForm button[type="submit"]');
            if (submitBtn) {
                submitBtn.textContent = 'Êõ¥Êñ∞ÊèêÁ§∫';
                submitBtn.onclick = (e) => {
                    e.preventDefault();
                    updateHint(level);
                };
            }
        }
        
        // Êõ¥Êñ∞ÊèêÁ§∫
        async function updateHint(level) {
            if (!currentHintsChallenge) {
                showToast('ÈåØË™§', 'ÁÑ°Ê≥ïÁç≤ÂèñÈ°åÁõÆË≥áË®ä', 'error');
                return;
            }
            
            const hintData = {
                cost: parseInt(document.getElementById('hintCost').value),
                content: document.getElementById('hintContent').value
            };
            
            try {
                const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints/${level}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hintData)
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Êõ¥Êñ∞ÊèêÁ§∫Â§±Êïó');
                }
                
                showToast('ÊàêÂäü', 'ÊèêÁ§∫Êõ¥Êñ∞ÊàêÂäü', 'success');
                
                // ÈáçÊñ∞ËºâÂÖ•ÊèêÁ§∫ÂàóË°®
                await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
                
                // ÈáçÁΩÆË°®ÂñÆÂíåÊåâÈàï
                document.getElementById('addHintForm').reset();
                const submitBtn = document.querySelector('#addHintForm button[type="submit"]');
                if (submitBtn) {
                    submitBtn.textContent = 'Êñ∞Â¢ûÊèêÁ§∫';
                    submitBtn.onclick = null;
                }
            } catch (error) {
                showToast('Êõ¥Êñ∞Â§±Êïó', error.message, 'error');
            }
        }
        
        // Âà™Èô§ÊèêÁ§∫
        async function deleteHint(level) {
            if (!currentHintsChallenge) {
                showToast('ÈåØË™§', 'ÁÑ°Ê≥ïÁç≤ÂèñÈ°åÁõÆË≥áË®ä', 'error');
                return;
            }
            
            if (!confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ÊèêÁ§∫ ${level} ÂóéÔºü`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints/${level}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Âà™Èô§ÊèêÁ§∫Â§±Êïó');
                }
                
                showToast('ÊàêÂäü', 'ÊèêÁ§∫Âà™Èô§ÊàêÂäü', 'success');
                
                // ÈáçÊñ∞ËºâÂÖ•ÊèêÁ§∫ÂàóË°®
                await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
            } catch (error) {
                showToast('Âà™Èô§Â§±Êïó', error.message, 'error');
            }
        }
        
        // ËºâÂÖ•È°åÁõÆÊèêÁ§∫
        async function loadChallengeHints(category, folderName) {
            try {
                const response = await fetch(`/api/challenges/${category}/${folderName}/hints`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'ËºâÂÖ•ÊèêÁ§∫Â§±Êïó');
                }
                
                renderHints(data.hints || []);
            } catch (error) {
                console.error('ËºâÂÖ•ÊèêÁ§∫Â§±Êïó:', error);
                renderHints([]);
            }
        }

        async function viewChallenge(category, folderName) {
            // È©óË≠âÂèÉÊï∏
            if (!category || !folderName || category === 'undefined' || folderName === 'undefined') {
                showToast('ÈåØË™§', 'ÁÑ°ÊïàÁöÑÈ°åÁõÆÂèÉÊï∏', 'error');
                console.error('Invalid parameters:', { category, folderName });
                return;
            }
            
            try {
                // È°ØÁ§∫Ê®°ÊÖãÊ°Ü‰∏¶ËºâÂÖ•
                const modal = new bootstrap.Modal(document.getElementById('challengeDetailsModal'));
                document.getElementById('challengeDetailsContent').innerHTML = `
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                        </div>
                    </div>
                `;
                modal.show();
                
                // Áç≤ÂèñÈ°åÁõÆË©≥ÊÉÖ
                const response = await fetch(`/api/challenges/${category}/${folderName}/details`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const challenge = await response.json();
                
                // Ê∏≤ÊüìÈ°åÁõÆË©≥ÊÉÖ
                renderChallengeDetails(challenge);
                
                // Ë®≠ÁΩÆÊåâÈàïÂäüËÉΩ
                const hintsBtn = document.getElementById('manageChallengeHintsBtn');
                if (hintsBtn) {
                    hintsBtn.style.display = 'inline-block';
                    hintsBtn.onclick = () => {
                        modal.hide();
                        openHintsManager(0, 0, challenge.title, category, folderName);
                    };
                }
                
                const editBtn = document.getElementById('editChallengeBtn');
                if (editBtn) {
                    editBtn.style.display = 'inline-block';
                    editBtn.onclick = () => {
                        modal.hide();
                        editChallenge(category, folderName);
                    };
                }
                
            } catch (error) {
                console.error('ËºâÂÖ•È°åÁõÆË©≥ÊÉÖÂ§±Êïó:', error);
                document.getElementById('challengeDetailsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>ËºâÂÖ•Â§±Êïó</strong><br>
                        ÁÑ°Ê≥ïËºâÂÖ•È°åÁõÆË©≥ÊÉÖÔºö${error.message}
                    </div>
                `;
            }
        }
        
        function renderChallengeDetails(challenge) {
            const difficultyColors = {
                'baby': 'success',
                'easy': 'info', 
                'middle': 'warning',
                'hard': 'danger',
                'impossible': 'dark'
            };
            
            const difficultyIcons = {
                'baby': 'üçº',
                'easy': '‚≠ê',
                'middle': '‚≠ê‚≠ê', 
                'hard': '‚≠ê‚≠ê‚≠ê',
                'impossible': 'üíÄ'
            };
            
            const statusColors = {
                'planning': 'secondary',
                'developing': 'warning',
                'testing': 'info',
                'completed': 'success',
                'deployed': 'primary'
            };
            
            const typeIcons = {
                'nc_challenge': 'üîå',
                'static_container': 'üê≥',
                'dynamic_container': 'üîÑ',
                'static_attachment': 'üìé',
                'dynamic_attachment': 'üìã'
            };
            
            const typeNames = {
                'nc_challenge': 'NC È°åÁõÆ',
                'static_container': 'ÈùúÊÖãÂÆπÂô®',
                'dynamic_container': 'ÂãïÊÖãÂÆπÂô®',
                'static_attachment': 'ÈùúÊÖãÈôÑ‰ª∂',
                'dynamic_attachment': 'ÂãïÊÖãÈôÑ‰ª∂'
            };
            
            const difficultyColor = difficultyColors[challenge.difficulty] || 'secondary';
            const difficultyIcon = difficultyIcons[challenge.difficulty] || '‚ùì';
            const statusColor = statusColors[challenge.status] || 'secondary';
            const statusIcon = getStatusIcon(challenge.status);
            const typeIcon = typeIcons[challenge.challenge_type] || 'üìé';
            const typeName = typeNames[challenge.challenge_type] || challenge.challenge_type;
            
            const hintsHtml = challenge.hints && challenge.hints.length > 0 ? 
                challenge.hints.map(hint => `
                    <div class="alert alert-info alert-sm mb-2">
                        <div class="d-flex justify-content-between">
                            <span><strong>Level ${hint.level}</strong> (${hint.cost} ÂàÜ)</span>
                        </div>
                        <div class="mt-1">${hint.content}</div>
                    </div>
                `).join('') : '<p class="text-muted">Êö´ÁÑ°ÊèêÁ§∫</p>';
            
            document.getElementById('challengeDetailsContent').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-info-circle"></i> Âü∫Êú¨Ë≥áË®ä
                        </h6>
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="fw-bold" style="width: 30%;">Ê®ôÈ°å:</td>
                                <td>${challenge.title}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">‰ΩúËÄÖ:</td>
                                <td>${challenge.author}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">ÂàÜÈ°û:</td>
                                <td><span class="badge bg-secondary">${challenge.category}</span></td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Èõ£Â∫¶:</td>
                                <td>
                                    <span class="badge bg-${difficultyColor}">
                                        ${difficultyIcon} ${challenge.difficulty}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">È°ûÂûã:</td>
                                <td>${typeIcon} ${typeName}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">ÁãÄÊÖã:</td>
                                <td>
                                    <span class="badge bg-${statusColor}">
                                        ${statusIcon} ${challenge.status}
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td class="fw-bold">ÂàÜÊï∏:</td>
                                <td>${challenge.points || 'Êú™Ë®≠ÂÆö'}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">ÂéüÂßãÁ¢º:</td>
                                <td>${challenge.source_code_provided ? '‚úÖ Êèê‰æõ' : '‚ùå ‰∏çÊèê‰æõ'}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-gear"></i> ÈÉ®ÁΩ≤Ë≥áË®ä
                        </h6>
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="fw-bold" style="width: 30%;">Âª∫Á´ãÊôÇÈñì:</td>
                                <td>${challenge.created_at ? new Date(challenge.created_at).toLocaleDateString() : 'Êú™Áü•'}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Ê™îÊ°à:</td>
                                <td>${challenge.files && challenge.files.length > 0 ? challenge.files.join(', ') : 'ÁÑ°'}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Ê®ôÁ±§:</td>
                                <td>
                                    ${challenge.tags && challenge.tags.length > 0 ? 
                                        challenge.tags.map(tag => `<span class="badge bg-light text-dark me-1">${tag}</span>`).join('') : 
                                        'ÁÑ°'
                                    }
                                </td>
                            </tr>
                            ${challenge.challenge_type === 'nc_challenge' ? `
                            <tr>
                                <td class="fw-bold">NC Á´ØÂè£:</td>
                                <td>${challenge.deploy_info?.nc_port || 9999}</td>
                            </tr>
                            <tr>
                                <td class="fw-bold">Ë∂ÖÊôÇ:</td>
                                <td>${challenge.deploy_info?.timeout || 60} Áßí</td>
                            </tr>
                            ` : ''}
                            ${challenge.deploy_info?.url ? `
                            <tr>
                                <td class="fw-bold">URL:</td>
                                <td><a href="${challenge.deploy_info.url}" target="_blank">${challenge.deploy_info.url}</a></td>
                            </tr>
                            ` : ''}
                        </table>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-file-text"></i> È°åÁõÆÊèèËø∞
                        </h6>
                        <div class="bg-light p-3 rounded">
                            ${challenge.description ? challenge.description.replace(/\n/g, '<br>') : 'ÁÑ°ÊèèËø∞'}
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-lightbulb"></i> È°åÁõÆÊèêÁ§∫
                        </h6>
                        <div>
                            ${hintsHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        // ËºâÂÖ•ÈÄ≤Â∫¶Ë°®Ê†º
        async function loadProgressTable() {
            try {
                const progress = await api.getProgress();
                updateProgressTable(progress);
            } catch (error) {
                updateProgressTable(challengeData);
            }
        }

        // Êõ¥Êñ∞ÈÄ≤Â∫¶Ë°®Ê†ºÔºàËàáÈ¶ñÈ†ÅÁõ∏ÂêåÔºâ
        function updateProgressTable(data) {
            const tbody = document.getElementById('progressTableBody');
            const thead = document.querySelector('#progressTable thead tr');
            
            // Â¶ÇÊûúÊúâÊñ∞ÁöÑË°®Ê†ºÊ®ôÈ°åÔºåÊõ¥Êñ∞ÂÆÉÂÄë
            if (data.table_headers) {
                let headerHtml = '';
                data.table_headers.forEach(header => {
                    if (header.includes('ÂàÜÈ°û')) {
                        headerHtml += `<th style="width: 180px;">${header}</th>`;
                    } else {
                        headerHtml += `<th class="text-center" style="width: 60px;">${header}</th>`;
                    }
                });
                thead.innerHTML = headerHtml;
            }
            
            let html = '';
            
            // Â¶ÇÊûúÂæåÁ´ØÊèê‰æõ‰∫ÜË°®Ê†ºË°åÊï∏ÊìöÔºåÁõ¥Êé•‰ΩøÁî®
            if (data.table_rows) {
                data.table_rows.forEach((row, rowIndex) => {
                    html += '<tr>';
                    row.forEach((cell, cellIndex) => {
                        if (cellIndex === 0) {
                            // ÂàÜÈ°ûÂêçÁ®±Ê¨Ñ‰Ωç
                            html += `<td class="fw-bold">${cell}</td>`;
                        } else {
                            // È°åÁõÆÁãÄÊÖãÊ¨Ñ‰Ωç
                            if (typeof cell === 'object' && cell !== null) {
                                if (cell.type === 'challenge') {
                                    // È°åÁõÆÂ≠òÂú®ÁöÑÊÉÖÊ≥Å
                                    html += `
                                        <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                            <div class="card border-${cell.color} h-100">
                                                <div class="card-body p-2">
                                                    <div class="fw-bold mb-1" style="font-size: 0.9rem; color: var(--ctf-gray-900);">
                                                        ${cell.icon} ${cell.title}
                                                    </div>
                                                    <div class="small mb-1" style="color: var(--ctf-gray-600);">
                                                        üë§ ${cell.author}
                                                    </div>
                                                    <div class="small mb-2">
                                                        <span class="badge bg-${cell.color}" style="font-size: 0.7rem; color: white;">
                                                            üéØ ${cell.difficulty.charAt(0).toUpperCase() + cell.difficulty.slice(1)}
                                                        </span>
                                                    </div>
                                                    <div class="btn-group btn-group-sm w-100" role="group">
                                                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                                            onclick="openHintsManager(${rowIndex}, ${cellIndex}, '${cell.title?.replace(/'/g, "\\'")}', '${cell.category}', '${cell.folder_name}')"
                                                            title="ÁÆ°ÁêÜÊèêÁ§∫">
                                                            üí°
                                                        </button>
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                            onclick="viewChallenge('${cell.category}', '${cell.folder_name}')"
                                                            title="Êü•ÁúãË©≥ÊÉÖ">
                                                            üëÅÔ∏è
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    `;
                                } else if (cell.type === 'empty') {
                                    // ÂæÖÂâµÂª∫È°åÁõÆ
                                    html += `
                                        <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                            <div class="card border-light h-100 border-dashed">
                                                <div class="card-body p-2 d-flex align-items-center justify-content-center">
                                                    <div style="color: var(--ctf-gray-600);">
                                                        <div class="fs-4">‚ö™</div>
                                                        <div class="small fw-bold">ÂæÖÂâµÂª∫</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    `;
                                } else {
                                    // ‰∏çÈúÄË¶ÅÁöÑÊ¨Ñ‰Ωç
                                    html += `
                                        <td class="text-center p-2" style="min-width: 150px;">
                                            <div style="color: var(--ctf-gray-500);">
                                                <div class="fs-4">‚¨ú</div>
                                                <div class="small">‰∏çÈúÄË¶Å</div>
                                            </div>
                                        </td>
                                    `;
                                }
                            } else {
                                // ÈôçÁ¥öËôïÁêÜÔºöÂ≠ó‰∏≤ÂΩ¢Âºè
                                html += `<td class="text-center challenge-cell" title="${cell}">
                                    <div class="fs-5">${cell}</div>
                                </td>`;
                            }
                        }
                    });
                    html += '</tr>';
                });
            } else {
                // ÈôçÁ¥öËôïÁêÜÔºö‰ΩøÁî®ËàäÁöÑÈÇèËºØ
                const categories = data.categories_order || ['general', 'web', 'pwn', 'reverse', 'crypto', 'forensic', 'misc'];
                const quotaConfig = data.quota_config || {};
                const maxChallenges = Math.max(6, ...Object.values(quotaConfig), ...categories.map(cat => (data.challenges?.[cat] || []).length));

                categories.forEach(category => {
                    const challenges = data.challenges?.[category] || [];
                    const quota = quotaConfig[category] || 0;
                    
                    html += `<tr><td class="fw-bold">${category.toUpperCase()}</td>`;
                    
                    for (let i = 0; i < maxChallenges; i++) {
                        if (i < challenges.length) {
                            const challenge = challenges[i];
                            html += `<td class="text-center challenge-cell" onclick="showChallengeDetails('${category}', ${i})" style="cursor: pointer;">
                                <div class="badge bg-success">${challenge.title}</div>
                            </td>`;
                        } else if (i < quota) {
                            html += `<td class="text-center challenge-cell">‚ö™</td>`;
                        } else {
                            html += `<td class="text-center challenge-cell">‚¨ú</td>`;
                        }
                    }
                    
                    html += '</tr>';
                });
            }
            
            tbody.innerHTML = html;
        }

        // ËàäÁöÑÁü©Èô£ÂáΩÊï∏Ôºà‰øùÁïô‰ΩúÁÇ∫ÂÇôÁî®Ôºâ
        function updateProgressMatrix(data) {
            // ‰ΩøÁî®ÂæåÁ´ØËøîÂõûÁöÑÈÖçÈ°çÈ†ÜÂ∫èÔºåÊàñ‰ΩøÁî®È†êË®≠È†ÜÂ∫è
            const categories = data.categories_order || ['general', 'web', 'pwn', 'reverse', 'crypto', 'forensic', 'misc'];
            const quotaConfig = data.quota_config || {};
            const maxChallenges = Math.max(6, ...Object.values(quotaConfig), ...categories.map(cat => (data.challenges?.[cat] || []).length));

            // Ë°®È†≠ - ‰ΩøÁî®ÂãïÊÖãÊ®ôÈ°å
            let headerHtml = '<th>ÂàÜÈ°û (ÁèæÊúâ/ÁõÆÊ®ô)</th>';
            for (let i = 0; i < maxChallenges; i++) {
                headerHtml += `<th class="text-center" style="width: 150px;">${String.fromCharCode(65 + i)}</th>`;
            }
            document.getElementById('matrixHeader').innerHTML = headerHtml;

            // Ë°®Ê†ºÂÖßÂÆπ
            let bodyHtml = '';
            categories.forEach(category => {
                const challenges = data.challenges?.[category] || [];
                const targetCount = quotaConfig[category] || challenges.length;
                const categoryDisplay = `${category.charAt(0).toUpperCase() + category.slice(1)} (${challenges.length}/${targetCount})`;
                
                bodyHtml += `<tr><td class="fw-bold">${categoryDisplay}</td>`;
                
                for (let i = 0; i < maxChallenges; i++) {
                    if (i < challenges.length) {
                        const challenge = challenges[i];
                        const title = challenge.title || challenge.name || 'Êú™ÂëΩÂêç';
                        const author = challenge.author || 'Êú™Áü•';
                        const difficulty = challenge.difficulty || 'easy';
                        const status = challenge.status || 'planning';
                        
                        // Èõ£Â∫¶È°èËâ≤Êò†Â∞Ñ
                        const difficultyColors = {
                            'baby': 'success',
                            'easy': 'info', 
                            'middle': 'warning',
                            'hard': 'danger',
                            'impossible': 'dark'
                        };
                        
                        const statusIcon = getStatusIcon(status);
                        const color = difficultyColors[difficulty] || 'secondary';
                        
                        const folderName = challenge.folder_name || challenge.name || `challenge_${i}`;
                        
                        bodyHtml += `
                            <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                <div class="card border-${color} h-100">
                                    <div class="card-body p-2">
                                        <div class="fw-bold mb-1" style="font-size: 0.9rem; color: var(--ctf-gray-900);">
                                            ${statusIcon} ${title}
                                        </div>
                                        <div class="small mb-1" style="color: var(--ctf-gray-600);">
                                            üë§ ${author}
                                        </div>
                                        <div class="small mb-2">
                                            <span class="badge bg-${color}" style="font-size: 0.7rem; color: white;">
                                                üéØ ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}
                                            </span>
                                        </div>
                                        <div class="btn-group btn-group-sm w-100" role="group">
                                            <button type="button" class="btn btn-outline-primary btn-sm" 
                                                onclick="openHintsManager(${categories.indexOf(category)}, ${i}, '${title.replace(/'/g, "\\'")}', '${category}', '${folderName}')"
                                                title="ÁÆ°ÁêÜÊèêÁ§∫">
                                                üí°
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                onclick="viewChallenge('${category}', '${folderName}')"
                                                title="Êü•ÁúãË©≥ÊÉÖ">
                                                üëÅÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        `;
                    } else if (i < targetCount) {
                        // ÂæÖÂâµÂª∫È°åÁõÆ
                        bodyHtml += `
                            <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                <div class="card border-light h-100 border-dashed">
                                    <div class="card-body p-2 d-flex align-items-center justify-content-center">
                                        <div style="color: var(--ctf-gray-600);">
                                            <div class="fs-4">‚ö™</div>
                                            <div class="small fw-bold">ÂæÖÂâµÂª∫</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        `;
                    } else {
                        // ‰∏çÈúÄË¶ÅÁöÑÊ¨Ñ‰Ωç
                        bodyHtml += `
                            <td class="text-center p-2" style="min-width: 150px;">
                                <div style="color: var(--ctf-gray-500);">
                                    <div class="fs-4">‚¨ú</div>
                                    <div class="small">‰∏çÈúÄË¶Å</div>
                                </div>
                            </td>
                        `;
                    }
                }
                
                bodyHtml += '</tr>';
            });

            document.getElementById('matrixBody').innerHTML = bodyHtml;
        }

        // Êõ¥Êñ∞È°åÁõÆÂàóË°®
        function updateChallengeList(challenges) {
            // Âπ≥Âù¶ÂåñÈ°åÁõÆÂàóË°®‰æøÊñºÁØ©ÈÅ∏
            filteredChallenges = [];
            Object.entries(challenges).forEach(([category, challengeList]) => {
                challengeList.forEach(challenge => {
                    filteredChallenges.push({
                        ...challenge,
                        category: category
                    });
                });
            });

            applyFilters();
        }

        // ÊáâÁî®ÁØ©ÈÅ∏Âô®
        function applyFilters() {
            const categoryFilter = document.getElementById('filterCategory').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const difficultyFilter = document.getElementById('filterDifficulty').value;
            const searchQuery = document.getElementById('searchQuery').value.toLowerCase();

            let filtered = filteredChallenges.filter(challenge => {
                const matchCategory = !categoryFilter || challenge.category === categoryFilter;
                const matchStatus = !statusFilter || challenge.status === statusFilter;
                const matchDifficulty = !difficultyFilter || challenge.difficulty === difficultyFilter;
                const matchSearch = !searchQuery || 
                    challenge.title.toLowerCase().includes(searchQuery) ||
                    challenge.description.toLowerCase().includes(searchQuery) ||
                    challenge.author.toLowerCase().includes(searchQuery);

                return matchCategory && matchStatus && matchDifficulty && matchSearch;
            });

            // Êõ¥Êñ∞Ë®àÊï∏
            document.getElementById('totalChallengesCount').textContent = filtered.length;

            // Êõ¥Êñ∞È°ØÁ§∫
            if (currentView === 'table') {
                updateTableView(filtered);
            } else {
                updateCardView(filtered);
            }
        }

        // Êõ¥Êñ∞Ë°®Ê†ºÊ™¢Ë¶ñ
        function updateTableView(challenges) {
            let html = '';
            
            challenges.forEach(challenge => {
                const statusColor = getStatusColor(challenge.status);
                const difficultyIcon = getDifficultyIcon(challenge.difficulty);
                const typeIcon = getTypeIcon(challenge.challenge_type);
                const sourceIcon = challenge.source_code_provided ? 'üìÑ' : 'üîí';
                
                html += `
                    <tr onclick="showChallengeDetails('${challenge.category}', '${challenge.folder_name}')" style="cursor: pointer;">
                        <td class="fw-bold">${challenge.title}</td>
                        <td><span class="badge bg-secondary">${challenge.category}</span></td>
                        <td>${difficultyIcon}</td>
                        <td>${typeIcon}</td>
                        <td><span class="badge bg-${statusColor}">${getStatusIcon(challenge.status)} ${challenge.status}</span></td>
                        <td>${challenge.author}</td>
                        <td>${sourceIcon}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); editChallenge('${challenge.category}', '${challenge.folder_name}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            if (html === '') {
                html = '<tr><td colspan="8" class="text-center text-muted py-4">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÈ°åÁõÆ</td></tr>';
            }

            document.getElementById('challengeTableBody').innerHTML = html;
        }

        // Êõ¥Êñ∞Âç°ÁâáÊ™¢Ë¶ñ
        function updateCardView(challenges) {
            let html = '';
            
            challenges.forEach(challenge => {
                const statusColor = getStatusColor(challenge.status);
                const difficultyIcon = getDifficultyIcon(challenge.difficulty);
                const typeIcon = getTypeIcon(challenge.challenge_type);
                const sourceIcon = challenge.source_code_provided ? 'üìÑ' : 'üîí';
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100 challenge-card" onclick="showChallengeDetails('${challenge.category}', '${challenge.folder_name}')" style="cursor: pointer;">
                            <div class="card-header bg-${statusColor} text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">${challenge.title}</h6>
                                <span class="badge bg-light text-dark">${challenge.category}</span>
                            </div>
                            <div class="card-body">
                                <p class="card-text small text-muted">${challenge.description.substring(0, 100)}${challenge.description.length > 100 ? '...' : ''}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        ${difficultyIcon} ${typeIcon} ${sourceIcon}
                                    </small>
                                    <small class="text-muted">${challenge.author}</small>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-${statusColor}">${getStatusIcon(challenge.status)} ${challenge.status}</span>
                                    <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); editChallenge('${challenge.category}', '${challenge.folder_name}')">
                                        <i class="bi bi-pencil"></i> Á∑®ËºØ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            if (html === '') {
                html = '<div class="col-12 text-center text-muted py-5">Ê≤íÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÈ°åÁõÆ</div>';
            }

            document.getElementById('challengeCards').innerHTML = html;
        }

        // ÂàáÊèõÊ™¢Ë¶ñÊ®°Âºè
        function changeView(view) {
            currentView = view;
            
            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ÂàáÊèõÊ™¢Ë¶ñ
            if (view === 'table') {
                document.getElementById('tableView').classList.remove('d-none');
                document.getElementById('cardView').classList.add('d-none');
            } else {
                document.getElementById('tableView').classList.add('d-none');
                document.getElementById('cardView').classList.remove('d-none');
            }
            
            applyFilters();
        }

        // È°ØÁ§∫È°åÁõÆË©≥ÊÉÖÔºàÁµ±‰∏ÄÂáΩÊï∏ÂêçÁ®±Ôºâ
        async function showChallengeDetails(category, challengeIdentifier) {
            // È©óË≠âÂü∫Êú¨ÂèÉÊï∏
            if (!category || category === 'undefined') {
                showToast('ÈåØË™§', 'ÁÑ°ÊïàÁöÑÈ°åÁõÆÂàÜÈ°û', 'error');
                console.error('Invalid category:', category);
                return;
            }
            
            // ËôïÁêÜ‰∏çÂêåÁöÑË™øÁî®ÊñπÂºè
            let folderName = challengeIdentifier;
            
            // Â¶ÇÊûú challengeIdentifier ÊòØÊï∏Â≠óÔºàÁ¥¢ÂºïÔºâÔºåÂâáÈúÄË¶ÅÊâæÂà∞Â∞çÊáâÁöÑ folderName
            if (typeof challengeIdentifier === 'number') {
                const challenges = challengeData.challenges?.[category];
                if (challenges && challenges[challengeIdentifier]) {
                    folderName = challenges[challengeIdentifier].folder_name;
                } else {
                    showToast('ÈåØË™§', 'Êâæ‰∏çÂà∞ÊåáÂÆöÁöÑÈ°åÁõÆ', 'error');
                    return;
                }
            }
            
            // Ë™øÁî®Êü•ÁúãË©≥ÊÉÖÂáΩÊï∏
            await viewChallenge(category, folderName);
        }

        // Á∑®ËºØÈ°åÁõÆ
        function editChallenge(category, name) {
            if (category && name) {
                showToast('Á∑®ËºØÈ°åÁõÆ', `Á∑®ËºØÂäüËÉΩÈñãÁôº‰∏≠ - ${category}/${name}`, 'info');
            } else if (selectedChallenge) {
                showToast('Á∑®ËºØÈ°åÁõÆ', `Á∑®ËºØÂäüËÉΩÈñãÁôº‰∏≠ - ${selectedChallenge.category}/${selectedChallenge.challenge.folder_name}`, 'info');
            }
        }

        // Ê∏ÖÈô§ÊêúÂ∞ã
        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            applyFilters();
        }

        // Âà∑Êñ∞Ë≥áÊñô
        function refreshData() {
            loadProgressData();
            showToast('Ë≥áÊñôÂ∑≤Âà∑Êñ∞', 'ÈÄ≤Â∫¶Ë≥áÊñôÂ∑≤ÈáçÊñ∞ËºâÂÖ•', 'success');
        }

        // ËºîÂä©ÂáΩÊï∏
        function getStatusIcon(status) {
            const icons = {
                'planning': 'üìù',
                'developing': 'üî®',
                'testing': 'üß™',
                'completed': '‚úÖ',
                'deployed': 'üöÄ'
            };
            return icons[status] || '‚ùì';
        }

        function getStatusColor(status) {
            const colors = {
                'planning': 'secondary',
                'developing': 'warning',
                'testing': 'info',
                'completed': 'success',
                'deployed': 'primary'
            };
            return colors[status] || 'secondary';
        }

        function getTypeIcon(challengeType) {
            const icons = {
                'nc_challenge': 'üîå',
                'static_container': 'üê≥',
                'dynamic_container': 'üîÑ',
                'static_attachment': 'üìé',
                'dynamic_attachment': 'üìã'
            };
            return icons[challengeType] || 'üìé';
        }

        function getTypeName(challengeType) {
            const names = {
                'nc_challenge': 'NC È°åÁõÆ',
                'static_container': 'ÈùúÊÖãÂÆπÂô®',
                'dynamic_container': 'ÂãïÊÖãÂÆπÂô®',
                'static_attachment': 'ÈùúÊÖãÈôÑ‰ª∂',
                'dynamic_attachment': 'ÂãïÊÖãÈôÑ‰ª∂'
            };
            return names[challengeType] || challengeType;
        }

        function getDifficultyIcon(difficulty) {
            const icons = {
                'baby': 'üçº',
                'easy': '‚≠ê',
                'middle': '‚≠ê‚≠ê',
                'hard': '‚≠ê‚≠ê‚≠ê',
                'impossible': 'üíÄ'
            };
            return icons[difficulty] || '‚ùì';
        }

        // È°ØÁ§∫ Toast ÈÄöÁü•
        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0`;
            toast.id = toastId;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Ëá™ÂãïÁßªÈô§
            setTimeout(() => {
                if (document.getElementById(toastId)) {
                    toastContainer.removeChild(toast);
                }
            }, 5000);
        }
    </script>

    <!-- È°åÁõÆË©≥ÊÉÖ Modal -->
    <div class="modal fade" id="challengeDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-info-circle text-primary"></i> È°åÁõÆË©≥ÊÉÖ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="challengeDetailsContent">
                        <div class="d-flex justify-content-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" id="editChallengeBtn" style="display:none;">
                        <i class="bi bi-pencil"></i> Á∑®ËºØÈ°åÁõÆ
                    </button>
                    <button type="button" class="btn btn-outline-info" id="manageChallengeHintsBtn" style="display:none;">
                        <i class="bi bi-lightbulb"></i> ÁÆ°ÁêÜÊèêÁ§∫
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊèêÁ§∫ÁÆ°ÁêÜ Modal -->
    <div class="modal fade" id="hintsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-lightbulb text-warning"></i> È°åÁõÆÊèêÁ§∫ÁÆ°ÁêÜ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6 id="hintsModalTitle">È°åÁõÆÂêçÁ®±</h6>
                        <p class="text-muted">ÁÆ°ÁêÜÈ°åÁõÆÁöÑÊº∏ÈÄ≤ÂºèÊèêÁ§∫Á≥ªÁµ±</p>
                    </div>
                    
                    <!-- ÁèæÊúâÊèêÁ§∫ÂàóË°® -->
                    <div class="mb-4">
                        <h6>üìã ÁèæÊúâÊèêÁ§∫</h6>
                        <div id="existingHints" class="list-group">
                            <!-- ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <!-- Êñ∞Â¢ûÊèêÁ§∫Ë°®ÂñÆ -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">‚ûï Êñ∞Â¢ûÊèêÁ§∫</h6>
                        </div>
                        <div class="card-body">
                            <form id="addHintForm">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="hintLevel" class="form-label">ÊèêÁ§∫Á≠âÁ¥ö</label>
                                        <input type="number" class="form-control" id="hintLevel" min="1" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="hintCost" class="form-label">Ê∂àËÄóÂàÜÊï∏</label>
                                        <input type="number" class="form-control" id="hintCost" min="0" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Êìç‰Ωú</label>
                                        <div>
                                            <button type="submit" class="btn btn-primary">Êñ∞Â¢ûÊèêÁ§∫</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label for="hintContent" class="form-label">ÊèêÁ§∫ÂÖßÂÆπ</label>
                                    <textarea class="form-control" id="hintContent" rows="3" 
                                        placeholder="Ëº∏ÂÖ•Êº∏ÈÄ≤ÂºèÁöÑÊèêÁ§∫ÂÖßÂÆπ..." required></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>