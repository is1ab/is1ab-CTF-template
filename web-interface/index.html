<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS1AB CTF ç®¡ç†ä»‹é¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- å°èˆªåˆ— -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-shield-check"></i> IS1AB CTF ç®¡ç†
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="bi bi-house"></i> é¦–é 
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="create-challenge.html">
                            <i class="bi bi-plus-circle"></i> å‰µå»ºé¡Œç›®
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="progress.html">
                            <i class="bi bi-graph-up"></i> é€²åº¦æŸ¥çœ‹
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-tools"></i> å·¥å…·
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="updateReadme()">
                                <i class="bi bi-file-text"></i> æ›´æ–° README
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="validateAllChallenges()">
                                <i class="bi bi-check-square"></i> é©—è­‰é¡Œç›®
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="exportData()">
                                <i class="bi bi-download"></i> åŒ¯å‡ºè³‡æ–™
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item me-2">
                        <button class="btn btn-outline-light btn-sm" 
                                onclick="refreshData()" 
                                title="åˆ·æ–°è³‡æ–™ (Ctrl+R)"
                                data-bs-toggle="tooltip">
                            <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm" 
                                onclick="showKeyboardHelp()"
                                title="éµç›¤å¿«é€Ÿéµèªªæ˜"
                                data-bs-toggle="tooltip">
                            <i class="bi bi-keyboard"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- é€£ç·šéŒ¯èª¤æç¤º -->
        <div id="connectionError" class="alert alert-warning alert-dismissible fade show d-none" role="alert">
            <i class="bi bi-exclamation-triangle"></i>
            <strong>é€£ç·šéŒ¯èª¤</strong> ç„¡æ³•é€£æ¥åˆ°æœå‹™å™¨ï¼Œé¡¯ç¤ºçš„æ˜¯å¿«å–è³‡æ–™ã€‚
            <button type="button" class="btn btn-sm btn-outline-warning ms-2" onclick="retryConnection()">
                <i class="bi bi-arrow-clockwise"></i> é‡è©¦
            </button>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- è¼‰å…¥ä¸­è¦†è“‹å±¤ -->
        <div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center d-none" style="background: rgba(255,255,255,0.8); z-index: 1050;">
            <div class="text-center">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                </div>
                <h5>è¼‰å…¥ä¸­...</h5>
                <p class="text-muted">æ­£åœ¨å¾æœå‹™å™¨ç²å–æœ€æ–°è³‡æ–™</p>
            </div>
        </div>

        <!-- é é¢æ¨™é¡Œ -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-6">
                    <i class="bi bi-trophy text-warning"></i> CTF é¡Œç›®ç®¡ç†ä¸­å¿ƒ
                </h1>
                <p class="lead text-muted">ç®¡ç†å’Œè¿½è¹¤ CTF æ¯”è³½é¡Œç›®çš„é–‹ç™¼é€²åº¦</p>
            </div>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="row mb-4" id="statsCards">
            <div class="col-md-3 mb-3">
                <div class="card bg-primary text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">ç¸½é¡Œç›®æ•¸</h6>
                                <h2 class="mb-0 mt-2" id="totalChallenges">-</h2>
                                <small class="opacity-75">å€‹é¡Œç›®</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-collection"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">å·²å®Œæˆ</h6>
                                <h2 class="mb-0 mt-2" id="completedChallenges">-</h2>
                                <small class="opacity-75">å·²å®Œå·¥</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-check-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">é–‹ç™¼ä¸­</h6>
                                <h2 class="mb-0 mt-2" id="developingChallenges">-</h2>
                                <small class="opacity-75">é€²è¡Œä¸­</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-tools"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-info text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">å·²éƒ¨ç½²</h6>
                                <h2 class="mb-0 mt-2" id="deployedChallenges">-</h2>
                                <small class="opacity-75">å¯ä½¿ç”¨</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-cloud-upload"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é…é¡é€²åº¦ç¸½è¦½ -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-target text-primary"></i> é¡Œç›®é…é¡å®Œæˆé€²åº¦</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- ç¸½é€²åº¦ -->
                            <div class="col-lg-3 mb-3">
                                <div class="text-center">
                                    <h6 class="text-muted">ç¸½é€²åº¦</h6>
                                    <div class="position-relative d-inline-block">
                                        <canvas id="totalProgressChart" width="120" height="120"></canvas>
                                        <div class="position-absolute top-50 start-50 translate-middle text-center">
                                            <div class="fw-bold fs-5" id="totalProgressPercent">0%</div>
                                            <small class="text-muted" id="totalProgressText">0/0</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- åˆ†é¡é€²åº¦ -->
                            <div class="col-lg-3 mb-3">
                                <h6 class="text-muted mb-2">åˆ†é¡é€²åº¦</h6>
                                <div id="categoryQuotaProgress" style="max-height: 200px; overflow-y: auto;"></div>
                            </div>
                            
                            <!-- é›£åº¦é€²åº¦ -->
                            <div class="col-lg-3 mb-3">
                                <h6 class="text-muted mb-2">é›£åº¦é€²åº¦</h6>
                                <div id="difficultyQuotaProgress"></div>
                            </div>
                            
                            <!-- é…é¡é©—è­‰ -->
                            <div class="col-lg-3 mb-3">
                                <h6 class="text-muted mb-2">é…é¡é©—è­‰</h6>
                                <div id="quotaValidation"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡Œç›®é¡å‹å’ŒåŸå§‹ç¢¼åˆ†å¸ƒ -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-pie-chart text-primary"></i> é¡Œç›®é¡å‹åˆ†å¸ƒ</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="typeChart" width="400" height="250"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-bar-chart text-success"></i> é›£åº¦ & åŸå§‹ç¢¼åˆ†å¸ƒ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <h6>é›£åº¦åˆ†å¸ƒ</h6>
                                <div id="difficultyBars"></div>
                            </div>
                            <div class="col-12">
                                <h6>åŸå§‹ç¢¼æä¾›ç‹€æ³</h6>
                                <div class="d-flex justify-content-between">
                                    <div class="text-center">
                                        <div class="fs-3">ğŸ“„</div>
                                        <div class="fw-bold" id="sourceCodeProvided">-</div>
                                        <small class="text-muted">æä¾›åŸå§‹ç¢¼</small>
                                    </div>
                                    <div class="text-center">
                                        <div class="fs-3">ğŸ”’</div>
                                        <div class="fw-bold" id="sourceCodeNotProvided">-</div>
                                        <small class="text-muted">ä¸æä¾›åŸå§‹ç¢¼</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æœ€è¿‘æ´»å‹•å’Œå¿«é€Ÿæ“ä½œ -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history text-info"></i> æœ€è¿‘æ´»å‹•
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="loadRecentActivity()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity" style="max-height: 300px; overflow-y: auto;">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-lightning text-warning"></i> å¿«é€Ÿæ“ä½œ</h5>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <button class="btn btn-primary mb-2" onclick="window.location.href='create-challenge.html'">
                            <i class="bi bi-plus-circle"></i> å‰µå»ºæ–°é¡Œç›®
                        </button>
                        <button class="btn btn-success mb-2" onclick="updateReadme()">
                            <i class="bi bi-file-text"></i> æ›´æ–° README
                        </button>
                        <button class="btn btn-info mb-2" onclick="validateAllChallenges()">
                            <i class="bi bi-check-square"></i> é©—è­‰æ‰€æœ‰é¡Œç›®
                        </button>
                        <button class="btn btn-outline-secondary" onclick="window.location.href='progress.html'">
                            <i class="bi bi-graph-up"></i> æŸ¥çœ‹è©³ç´°é€²åº¦
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é€²åº¦è¡¨æ ¼ -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-table text-primary"></i> é¡Œç›®é€²åº¦ä¸€è¦½
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-success" onclick="exportData()">
                                <i class="bi bi-download"></i> åŒ¯å‡º
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadProgressTable()">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-striped" id="progressTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 100px;">åˆ†é¡</th>
                                        <th class="text-center">A</th>
                                        <th class="text-center">B</th>
                                        <th class="text-center">C</th>
                                        <th class="text-center">D</th>
                                        <th class="text-center">E</th>
                                        <th class="text-center">F</th>
                                    </tr>
                                </thead>
                                <tbody id="progressTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- åœ–ä¾‹ -->
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6 class="mb-2">åœ–ä¾‹èªªæ˜ï¼š</h6>
                            <div class="row small">
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>ç‹€æ…‹åœ–ç¤ºï¼š</strong></div>
                                    <div><span class="badge bg-secondary me-1">ğŸ“</span> è¦åŠƒä¸­</div>
                                    <div><span class="badge bg-warning me-1">ğŸ”¨</span> é–‹ç™¼ä¸­</div>
                                    <div><span class="badge bg-info me-1">ğŸ§ª</span> æ¸¬è©¦ä¸­</div>
                                    <div><span class="badge bg-success me-1">âœ…</span> å·²å®Œæˆ</div>
                                    <div><span class="badge bg-primary me-1">ğŸš€</span> å·²éƒ¨ç½²</div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>é›£åº¦é…è‰²ï¼š</strong></div>
                                    <div><span class="badge bg-success me-1">ğŸ¼</span> Baby</div>
                                    <div><span class="badge bg-info me-1">â­</span> Easy</div>
                                    <div><span class="badge bg-warning me-1">â­â­</span> Middle</div>
                                    <div><span class="badge bg-danger me-1">â­â­â­</span> Hard</div>
                                    <div><span class="badge bg-dark me-1">ğŸ’€</span> Impossible</div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-1"><strong>å…¶ä»–ï¼š</strong></div>
                                    <div><span class="text-muted me-1">âšª</span> å¾…å‰µå»ºé¡Œç›®</div>
                                    <div><span class="text-muted me-1">â¬œ</span> ä¸éœ€è¦</div>
                                    <div class="mt-2 small text-muted">
                                        æ¯å€‹å¡ç‰‡é¡¯ç¤ºï¼š<br>
                                        â€¢ é¡Œç›®åç¨±<br>
                                        â€¢ ä½œè€… (ğŸ‘¤)<br>
                                        â€¢ é›£åº¦ (ğŸ¯)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ˜éšŠä»»å‹™åˆ†é… -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-people text-success"></i> åœ˜éšŠä»»å‹™åˆ†é…</h5>
                    </div>
                    <div class="card-body">
                        <div id="teamAssignments" class="row">
                            <div class="col-12 text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for operations -->
    <div class="modal fade" id="operationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="operationModalTitle">æ“ä½œé€²è¡Œä¸­</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="operationModalBody">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">è™•ç†ä¸­...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="operationModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- æç¤ºç®¡ç† Modal -->
    <div class="modal fade" id="hintsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-lightbulb text-warning"></i> é¡Œç›®æç¤ºç®¡ç†</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6 id="hintsModalTitle">é¡Œç›®åç¨±</h6>
                        <p class="text-muted">ç®¡ç†é¡Œç›®çš„æ¼¸é€²å¼æç¤ºç³»çµ±</p>
                    </div>
                    
                    <!-- ç¾æœ‰æç¤ºåˆ—è¡¨ -->
                    <div class="mb-4">
                        <h6>ğŸ“‹ ç¾æœ‰æç¤º</h6>
                        <div id="existingHints" class="list-group">
                            <!-- å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <!-- æ–°å¢æç¤ºè¡¨å–® -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">â• æ–°å¢æç¤º</h6>
                        </div>
                        <div class="card-body">
                            <form id="addHintForm">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="hintLevel" class="form-label">æç¤ºç­‰ç´š</label>
                                        <input type="number" class="form-control" id="hintLevel" min="1" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="hintCost" class="form-label">æ¶ˆè€—åˆ†æ•¸</label>
                                        <input type="number" class="form-control" id="hintCost" min="0" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">æ“ä½œ</label>
                                        <div>
                                            <button type="submit" class="btn btn-primary">æ–°å¢æç¤º</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <label for="hintContent" class="form-label">æç¤ºå…§å®¹</label>
                                    <textarea class="form-control" id="hintContent" rows="3" 
                                        placeholder="è¼¸å…¥æ¼¸é€²å¼çš„æç¤ºå…§å®¹..." required></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡Œç›®è©³æƒ… Modal -->
    <div class="modal fade" id="challengeDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-info-circle text-primary"></i> é¡Œç›®è©³æƒ…</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="challengeDetailsContent">
                        <div class="d-flex justify-content-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" id="editChallengeBtn" style="display:none;">
                        <i class="bi bi-pencil"></i> ç·¨è¼¯é¡Œç›®
                    </button>
                    <button type="button" class="btn btn-outline-info" id="manageChallengeHintsBtn" style="display:none;">
                        <i class="bi bi-lightbulb"></i> ç®¡ç†æç¤º
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- éµç›¤å¿«é€Ÿéµèªªæ˜ Modal -->
    <div class="modal fade" id="keyboardHelpModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-keyboard"></i> éµç›¤å¿«é€Ÿéµ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th style="width: 40%;">å¿«é€Ÿéµ</th>
                                    <th>åŠŸèƒ½</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>R</kbd></td>
                                    <td>åˆ·æ–°è³‡æ–™</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>N</kbd></td>
                                    <td>å‰µå»ºæ–°é¡Œç›®</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>P</kbd></td>
                                    <td>é€²åº¦æŸ¥çœ‹é é¢</td>
                                </tr>
                                <tr>
                                    <td><kbd>Esc</kbd></td>
                                    <td>é—œé–‰æ‰€æœ‰å°è©±æ¡†</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="small text-muted mt-3">
                        <i class="bi bi-info-circle"></i>
                        åœ¨ Mac ç³»çµ±ä¸Šï¼Œè«‹ä½¿ç”¨ <kbd>Cmd</kbd> ä»£æ›¿ <kbd>Ctrl</kbd>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="api.js"></script>
    <script>
        // å…¨åŸŸè®Šæ•¸
        let challengeData = {};
        let typeChart = null;
        let totalProgressChart = null;

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadProgressTable();
            loadRecentActivity();
            loadTeamAssignments();
            setupKeyboardShortcuts();
            initializeTooltips();
        });

        // è¨­å®šéµç›¤å¿«é€Ÿéµ
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                // Ctrl/Cmd + R: åˆ·æ–°è³‡æ–™
                if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                    event.preventDefault();
                    refreshData();
                }
                
                // Ctrl/Cmd + N: æ–°å»ºé¡Œç›®
                if ((event.ctrlKey || event.metaKey) && event.key === 'n') {
                    event.preventDefault();
                    window.location.href = 'create-challenge.html';
                }
                
                // Ctrl/Cmd + P: é€²åº¦æŸ¥çœ‹
                if ((event.ctrlKey || event.metaKey) && event.key === 'p') {
                    event.preventDefault();
                    window.location.href = 'progress.html';
                }
                
                // ESC: é—œé–‰æ‰€æœ‰ Modal
                if (event.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal.show');
                    modals.forEach(modal => {
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        if (modalInstance) {
                            modalInstance.hide();
                        }
                    });
                }
            });
        }

        // è¼‰å…¥å„€è¡¨æ¿è³‡æ–™
        async function loadDashboardData() {
            try {
                showLoadingState(true);
                const stats = await api.getStats();
                challengeData = stats;
                updateStatsCards(stats);
                updateCharts(stats);
                loadProgressTable();
                loadRecentActivity();
                loadTeamAssignments();
                showLoadingState(false);
                hideConnectionError();
            } catch (error) {
                console.error('è¼‰å…¥å„€è¡¨æ¿å¤±æ•—:', error);
                showLoadingState(false);
                showConnectionError();
            }
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoadingState(isLoading) {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                if (isLoading) {
                    loadingOverlay.classList.remove('d-none');
                } else {
                    loadingOverlay.classList.add('d-none');
                }
            }
        }

        // é¡¯ç¤ºé€£ç·šéŒ¯èª¤
        function showConnectionError() {
            const errorAlert = document.getElementById('connectionError');
            if (errorAlert) {
                errorAlert.classList.remove('d-none');
            }
        }

        // éš±è—é€£ç·šéŒ¯èª¤
        function hideConnectionError() {
            const errorAlert = document.getElementById('connectionError');
            if (errorAlert) {
                errorAlert.classList.add('d-none');
            }
        }


        // æ›´æ–°çµ±è¨ˆå¡ç‰‡
        function updateStatsCards(stats) {
            document.getElementById('totalChallenges').textContent = stats.total_challenges || 0;
            document.getElementById('completedChallenges').textContent = stats.status_counts?.completed || 0;
            document.getElementById('developingChallenges').textContent = stats.status_counts?.developing || 0;
            document.getElementById('deployedChallenges').textContent = stats.status_counts?.deployed || 0;
        }

        // æ›´æ–°åœ–è¡¨
        function updateCharts(stats) {
            // æ›´æ–°é…é¡é€²åº¦
            updateQuotaProgress(stats);
            
            // é¡Œç›®é¡å‹åœ“é¤…åœ–
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            
            if (typeChart) {
                typeChart.destroy();
            }
            
            typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ğŸ“ éœæ…‹é™„ä»¶', 'ğŸ³ éœæ…‹å®¹å™¨', 'ğŸ“‹ å‹•æ…‹é™„ä»¶', 'ğŸ”„ å‹•æ…‹å®¹å™¨', 'ğŸ”Œ NC é¡Œç›®'],
                    datasets: [{
                        data: [
                            stats.type_counts?.static_attachment || 0,
                            stats.type_counts?.static_container || 0,
                            stats.type_counts?.dynamic_attachment || 0,
                            stats.type_counts?.dynamic_container || 0,
                            stats.type_counts?.nc_challenge || 0
                        ],
                        backgroundColor: [
                            '#1a73e8',  // è—è‰²
                            '#137333',  // ç¶ è‰²
                            '#ea8600',  // æ©™è‰²
                            '#d93025',  // ç´…è‰²
                            '#9334e6'   // ç´«è‰²
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10
                            }
                        }
                    }
                }
            });

            // é›£åº¦åˆ†å¸ƒæ¢ç‹€åœ–
            updateDifficultyBars(stats);
            
            // åŸå§‹ç¢¼åˆ†å¸ƒ
            document.getElementById('sourceCodeProvided').textContent = stats.source_code_counts?.provided || 0;
            document.getElementById('sourceCodeNotProvided').textContent = stats.source_code_counts?.not_provided || 0;
        }

        // æ›´æ–°é…é¡é€²åº¦
        function updateQuotaProgress(stats) {
            if (!stats.quota_progress) {
                return;
            }

            const quotaProgress = stats.quota_progress;

            // æ›´æ–°ç¸½é€²åº¦åœ“ç’°åœ–
            updateTotalProgressChart(quotaProgress.total_progress);

            // æ›´æ–°åˆ†é¡é€²åº¦
            updateCategoryProgress(quotaProgress.category_progress);

            // æ›´æ–°é›£åº¦é€²åº¦
            updateDifficultyProgress(quotaProgress.difficulty_progress);

            // æ›´æ–°é…é¡é©—è­‰
            updateQuotaValidation(quotaProgress.validation);
        }

        // æ›´æ–°ç¸½é€²åº¦åœ“ç’°åœ–
        function updateTotalProgressChart(totalProgress) {
            const ctx = document.getElementById('totalProgressChart').getContext('2d');
            
            if (totalProgressChart) {
                totalProgressChart.destroy();
            }

            const percentage = totalProgress.percentage || 0;
            const color = getProgressColor(totalProgress.status);

            totalProgressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [percentage, 100 - percentage],
                        backgroundColor: [color, '#f8f9fa'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            document.getElementById('totalProgressPercent').textContent = Math.round(percentage) + '%';
            document.getElementById('totalProgressText').textContent = `${totalProgress.current}/${totalProgress.target}`;
        }

        // æ›´æ–°åˆ†é¡é€²åº¦
        function updateCategoryProgress(categoryProgress) {
            const container = document.getElementById('categoryQuotaProgress');
            let html = '';

            Object.entries(categoryProgress).forEach(([category, progress]) => {
                const color = getProgressColor(progress.status);
                const percentage = Math.round(progress.percentage);
                
                html += `
                    <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small class="fw-bold">${category.toUpperCase()}</small>
                            <small class="text-muted">${progress.current}/${progress.target}</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar" style="background-color: ${color}; width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ›´æ–°é›£åº¦é€²åº¦
        function updateDifficultyProgress(difficultyProgress) {
            const container = document.getElementById('difficultyQuotaProgress');
            let html = '';

            const difficultyIcons = {
                'baby': 'ğŸ¼',
                'easy': 'â­',
                'middle': 'â­â­',
                'hard': 'â­â­â­',
                'impossible': 'ğŸ’€'
            };

            Object.entries(difficultyProgress).forEach(([difficulty, progress]) => {
                const color = getProgressColor(progress.status);
                const percentage = Math.round(progress.percentage);
                const icon = difficultyIcons[difficulty] || 'â“';
                
                html += `
                    <div class="mb-2">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small class="fw-bold">${icon} ${difficulty.toUpperCase()}</small>
                            <small class="text-muted">${progress.current}/${progress.target}</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar" style="background-color: ${color}; width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // æ›´æ–°é…é¡é©—è­‰
        function updateQuotaValidation(validation) {
            const container = document.getElementById('quotaValidation');
            
            if (!validation) {
                container.innerHTML = '<div class="text-muted small">é…é¡é©—è­‰è³‡æ–™ä¸å¯ç”¨</div>';
                return;
            }

            let html = '';
            
            // é©—è­‰ç‹€æ…‹æŒ‡ç¤ºå™¨
            const statusClass = validation.is_valid ? 'success' : 'warning';
            const statusIcon = validation.is_valid ? 'âœ…' : 'âš ï¸';
            const statusText = validation.is_valid ? 'é…é¡è¨­å®šæ­£ç¢º' : 'é…é¡éœ€è¦èª¿æ•´';
            
            html += `
                <div class="d-flex align-items-center mb-2">
                    <span class="me-2">${statusIcon}</span>
                    <span class="small fw-bold text-${statusClass}">${statusText}</span>
                </div>
            `;

            // éŒ¯èª¤è¨Šæ¯
            if (validation.errors && validation.errors.length > 0) {
                html += '<div class="mb-2">';
                validation.errors.forEach(error => {
                    html += `
                        <div class="alert alert-danger alert-sm py-1 px-2 mb-1" style="font-size: 0.75rem;">
                            <i class="bi bi-exclamation-triangle me-1"></i>${error}
                        </div>
                    `;
                });
                html += '</div>';
            }

            // è­¦å‘Šè¨Šæ¯
            if (validation.warnings && validation.warnings.length > 0) {
                html += '<div class="mb-2">';
                validation.warnings.forEach(warning => {
                    html += `
                        <div class="alert alert-warning alert-sm py-1 px-2 mb-1" style="font-size: 0.75rem;">
                            <i class="bi bi-exclamation me-1"></i>${warning}
                        </div>
                    `;
                });
                html += '</div>';
            }

            // å»ºè­°
            if (validation.suggestions && validation.suggestions.length > 0) {
                html += '<div class="mb-2">';
                html += '<div class="small text-muted mb-1">å»ºè­°ï¼š</div>';
                validation.suggestions.forEach(suggestion => {
                    html += `
                        <div class="alert alert-info alert-sm py-1 px-2 mb-1" style="font-size: 0.75rem;">
                            <i class="bi bi-lightbulb me-1"></i>${suggestion}
                        </div>
                    `;
                });
                html += '</div>';
            }

            // å¦‚æœæ²’æœ‰å•é¡Œï¼Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
            if (validation.is_valid && 
                (!validation.warnings || validation.warnings.length === 0) && 
                (!validation.suggestions || validation.suggestions.length === 0)) {
                html += `
                    <div class="alert alert-success alert-sm py-1 px-2" style="font-size: 0.75rem;">
                        <i class="bi bi-check-circle me-1"></i>é…é¡è¨­å®šå®Œå…¨æ­£ç¢º
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // æ ¹æ“šç‹€æ…‹å–å¾—é¡è‰²
        function getProgressColor(status) {
            const colors = {
                'completed': '#137333',     // æ·±ç¶ è‰²
                'in_progress': '#ea8600',   // æ©™è‰²
                'not_started': '#9aa0a6'    // ä¸­æ€§ç°
            };
            return colors[status] || colors['not_started'];
        }

        // æ›´æ–°é›£åº¦åˆ†å¸ƒæ¢ç‹€åœ–
        function updateDifficultyBars(stats) {
            const difficulties = [
                { name: 'ğŸ¼ Baby', count: stats.difficulty_counts?.baby || 0, color: '#137333' },
                { name: 'â­ Easy', count: stats.difficulty_counts?.easy || 0, color: '#1967d2' },
                { name: 'â­â­ Middle', count: stats.difficulty_counts?.middle || 0, color: '#ea8600' },
                { name: 'â­â­â­ Hard', count: stats.difficulty_counts?.hard || 0, color: '#d93025' },
                { name: 'ğŸ’€ Impossible', count: stats.difficulty_counts?.impossible || 0, color: '#5f6368' }
            ];

            const total = difficulties.reduce((sum, d) => sum + d.count, 0);
            const barsHtml = difficulties.map(d => {
                const percentage = total > 0 ? (d.count / total * 100) : 0;
                return `
                    <div class="d-flex align-items-center mb-1">
                        <div class="me-2" style="width: 80px; font-size: 12px;">${d.name}</div>
                        <div class="flex-grow-1">
                            <div class="progress" style="height: 15px;">
                                <div class="progress-bar" style="background-color: ${d.color}; width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="ms-2 small">${d.count}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('difficultyBars').innerHTML = barsHtml;
        }

        // è¼‰å…¥é€²åº¦è¡¨æ ¼
        async function loadProgressTable() {
            try {
                const progress = await api.getProgress();
                updateProgressTable(progress);
            } catch (error) {
                updateProgressTable(challengeData);
            }
        }

        // æ›´æ–°é€²åº¦è¡¨æ ¼
        function updateProgressTable(data) {
            const tbody = document.getElementById('progressTableBody');
            const thead = document.querySelector('#progressTable thead tr');
            
            // å¦‚æœæœ‰æ–°çš„è¡¨æ ¼æ¨™é¡Œï¼Œæ›´æ–°å®ƒå€‘
            if (data.table_headers) {
                let headerHtml = '';
                data.table_headers.forEach(header => {
                    if (header.includes('åˆ†é¡')) {
                        headerHtml += `<th style="width: 180px;">${header}</th>`;
                    } else {
                        headerHtml += `<th class="text-center" style="width: 60px;">${header}</th>`;
                    }
                });
                thead.innerHTML = headerHtml;
            }
            
            let html = '';
            
            // å¦‚æœå¾Œç«¯æä¾›äº†è¡¨æ ¼è¡Œæ•¸æ“šï¼Œç›´æ¥ä½¿ç”¨
            if (data.table_rows) {
                data.table_rows.forEach((row, rowIndex) => {
                    html += '<tr>';
                    row.forEach((cell, cellIndex) => {
                        if (cellIndex === 0) {
                            // åˆ†é¡åç¨±æ¬„ä½
                            html += `<td class="fw-bold">${cell}</td>`;
                        } else {
                            // é¡Œç›®ç‹€æ…‹æ¬„ä½
                            if (typeof cell === 'object' && cell !== null) {
                                if (cell.type === 'challenge') {
                                    // é¡Œç›®å­˜åœ¨çš„æƒ…æ³
                                    html += `
                                        <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                            <div class="card border-${cell.color} h-100">
                                                <div class="card-body p-2">
                                                    <div class="fw-bold mb-1" style="font-size: 0.9rem; color: var(--ctf-gray-900);">
                                                        ${cell.icon} ${cell.title}
                                                    </div>
                                                    <div class="small mb-1" style="color: var(--ctf-gray-600);">
                                                        ğŸ‘¤ ${cell.author}
                                                    </div>
                                                    <div class="small mb-2">
                                                        <span class="badge bg-${cell.color}" style="font-size: 0.7rem; color: white;">
                                                            ğŸ¯ ${cell.difficulty.charAt(0).toUpperCase() + cell.difficulty.slice(1)}
                                                        </span>
                                                    </div>
                                                    <div class="btn-group btn-group-sm w-100" role="group">
                                                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                                            onclick="openHintsManager(${rowIndex}, ${cellIndex}, '${cell.title?.replace(/'/g, "\\'")}', '${cell.category}', '${cell.folder_name}')"
                                                            title="ç®¡ç†æç¤º">
                                                            ğŸ’¡
                                                        </button>
                                                        <button type="button" class="btn btn-outline-secondary btn-sm" 
                                                            onclick="viewChallenge('${cell.category}', '${cell.folder_name}')"
                                                            title="æŸ¥çœ‹è©³æƒ…">
                                                            ğŸ‘ï¸
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    `;
                                } else if (cell.type === 'empty') {
                                    // å¾…å‰µå»ºé¡Œç›®
                                    html += `
                                        <td class="text-center challenge-cell p-2" style="min-width: 150px;">
                                            <div class="card border-light h-100 border-dashed">
                                                <div class="card-body p-2 d-flex align-items-center justify-content-center">
                                                    <div style="color: var(--ctf-gray-600);">
                                                        <div class="fs-4">âšª</div>
                                                        <div class="small fw-bold">å¾…å‰µå»º</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    `;
                                } else {
                                    // ä¸éœ€è¦çš„æ¬„ä½
                                    html += `
                                        <td class="text-center p-2" style="min-width: 150px;">
                                            <div style="color: var(--ctf-gray-500);">
                                                <div class="fs-4">â¬œ</div>
                                                <div class="small">ä¸éœ€è¦</div>
                                            </div>
                                        </td>
                                    `;
                                }
                            } else {
                                // é™ç´šè™•ç†ï¼šå­—ä¸²å½¢å¼
                                html += `<td class="text-center challenge-cell" title="${cell}">
                                    <div class="fs-5">${cell}</div>
                                </td>`;
                            }
                        }
                    });
                    html += '</tr>';
                });
            } else {
                // é™ç´šè™•ç†ï¼šä½¿ç”¨èˆŠçš„é‚è¼¯
                const categories = data.categories_order || ['general', 'web', 'pwn', 'reverse', 'crypto', 'forensic', 'misc'];
                const quotaConfig = data.quota_config || {};
                
                categories.forEach(category => {
                    const challenges = data.challenges?.[category] || [];
                    const targetCount = quotaConfig[category] || challenges.length;
                    const categoryDisplay = `${category.charAt(0).toUpperCase() + category.slice(1)} (${challenges.length}/${targetCount})`;
                    
                    html += `<tr>
                        <td class="fw-bold">${categoryDisplay}</td>`;
                    
                    const maxCols = Math.max(6, targetCount, challenges.length);
                    for (let i = 0; i < maxCols; i++) {
                        if (i < challenges.length) {
                            const challenge = challenges[i];
                            const status = challenge.status || 'planning';
                            const challengeType = challenge.challenge_type || 'static_attachment';
                            const sourceCode = challenge.source_code_provided;
                            
                            const statusIcon = getStatusIcon(status);
                            const typeIcon = getTypeIcon(challengeType);
                            const sourceIcon = sourceCode ? 'ğŸ“„' : 'ğŸ”’';
                            
                            html += `<td class="text-center challenge-cell" title="${challenge.title || 'Challenge ' + String.fromCharCode(65 + i)} - ${status}">
                                <div class="fs-5">${statusIcon}${typeIcon}</div>
                                <small class="text-muted">${sourceIcon}</small>
                            </td>`;
                        } else if (i < targetCount) {
                            html += `<td class="text-center challenge-cell" title="å¾…å‰µå»ºé¡Œç›®">
                                <div class="fs-5 text-muted">âšª</div>
                            </td>`;
                        } else {
                            html += `<td class="text-center" title="è¶…å‡ºç›®æ¨™é…é¡">
                                <div class="fs-5 text-muted">â¬œ</div>
                            </td>`;
                        }
                    }
                    
                    html += '</tr>';
                });
            }
            
            tbody.innerHTML = html;
        }

        // ç‚ºè¡¨æ ¼å–®å…ƒæ ¼ç”¢ç”Ÿæç¤ºæ–‡å­—
        function getTooltipForCell(data, rowIndex, colIndex) {
            if (!data.categories_order || !data.challenges) {
                return '';
            }
            
            const category = data.categories_order[rowIndex];
            const challenges = data.challenges[category] || [];
            
            if (colIndex < challenges.length) {
                const challenge = challenges[colIndex];
                return `${challenge.title || 'Challenge ' + String.fromCharCode(65 + colIndex)} - ${challenge.status || 'planning'}`;
            } else {
                const targetCount = data.quota_config?.[category] || challenges.length;
                if (colIndex < targetCount) {
                    return 'å¾…å‰µå»ºé¡Œç›®';
                } else {
                    return 'è¶…å‡ºç›®æ¨™é…é¡';
                }
            }
        }

        // å–å¾—ç‹€æ…‹åœ–ç¤º
        function getStatusIcon(status) {
            const icons = {
                'planning': 'ğŸ“',
                'developing': 'ğŸ”¨',
                'testing': 'ğŸ§ª',
                'completed': 'âœ…',
                'deployed': 'ğŸš€'
            };
            return icons[status] || 'â“';
        }

        // å–å¾—é¡å‹åœ–ç¤º
        function getTypeIcon(challengeType) {
            const icons = {
                'nc_challenge': 'ğŸ”Œ',
                'static_container': 'ğŸ³',
                'dynamic_container': 'ğŸ”„',
                'static_attachment': 'ğŸ“',
                'dynamic_attachment': 'ğŸ“‹'
            };
            return icons[challengeType] || '';
        }

        // è¼‰å…¥æœ€è¿‘æ´»å‹•
        async function loadRecentActivity() {
            const activityDiv = document.getElementById('recentActivity');
            try {
                const activities = await api.getRecentActivity();
                if (activities && activities.length > 0) {
                    activityDiv.innerHTML = activities.map(activity => `
                        <div class="d-flex align-items-start mb-3 p-2 border-start border-3 border-${activity.type === 'commit' ? 'primary' : 'success'}">
                            <div class="badge bg-${activity.type === 'commit' ? 'primary' : 'success'} me-3 mt-1">
                                <i class="bi bi-${activity.type === 'commit' ? 'git' : 'check'}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold mb-1">${activity.message}</div>
                                <small class="text-muted">
                                    <i class="bi bi-person"></i> ${activity.author} â€¢ 
                                    <i class="bi bi-clock"></i> ${activity.time}
                                </small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    activityDiv.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                            <p>æš«ç„¡æœ€è¿‘æ´»å‹•</p>
                        </div>`;
                }
            } catch (error) {
                activityDiv.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-clock-history fs-1 d-block mb-2"></i>
                        <p>æœ€è¿‘å»ºç«‹äº†ç¯„ä¾‹ PWN é¡Œç›®</p>
                        <small class="text-muted">Example Buffer Overflow â€¢ GZTime</small>
                    </div>`;
            }
        }

        // è¼‰å…¥åœ˜éšŠä»»å‹™åˆ†é…
        async function loadTeamAssignments() {
            const assignmentsDiv = document.getElementById('teamAssignments');
            try {
                const assignments = await api.getTeamAssignments();
                if (assignments && Object.keys(assignments).length > 0) {
                    let html = '';
                    Object.entries(assignments).forEach(([author, tasks]) => {
                        html += `
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="bi bi-person-circle"></i> ${author}
                                        </h6>
                                    </div>
                                    <div class="card-body p-3">
                        `;
                        
                        tasks.forEach(task => {
                            const statusColor = getStatusColor(task.status);
                            const sourceIcon = task.source_code_provided ? 'ğŸ“„' : 'ğŸ”’';
                            const typeIcon = getTypeIcon(task.challenge_type);
                            
                            html += `
                                <div class="d-flex align-items-center mb-2 p-2 border rounded">
                                    <div class="badge bg-${statusColor} me-2">${getStatusIcon(task.status)}</div>
                                    <div class="flex-grow-1">
                                        <div class="fw-bold small">${task.category}/${task.title}</div>
                                        <small class="text-muted">${task.difficulty} ${typeIcon} ${sourceIcon}</small>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    assignmentsDiv.innerHTML = html;
                } else {
                    assignmentsDiv.innerHTML = `
                        <div class="col-12 text-center py-4">
                            <i class="bi bi-people fs-1 text-muted d-block mb-2"></i>
                            <p class="text-muted">æš«ç„¡ä»»å‹™åˆ†é…</p>
                        </div>`;
                }
            } catch (error) {
                assignmentsDiv.innerHTML = `
                    <div class="col-12 text-center py-4">
                        <i class="bi bi-people fs-1 text-muted d-block mb-2"></i>
                        <p class="text-muted">ç„¡æ³•è¼‰å…¥ä»»å‹™åˆ†é…</p>
                    </div>`;
            }
        }

        // å–å¾—ç‹€æ…‹å°æ‡‰é¡è‰²
        function getStatusColor(status) {
            const colors = {
                'planning': 'secondary',
                'developing': 'warning',
                'testing': 'info',
                'completed': 'success',
                'deployed': 'primary'
            };
            return colors[status] || 'secondary';
        }

        // åˆ·æ–°æ‰€æœ‰è³‡æ–™
        async function refreshData() {
            try {
                showLoadingState(true);
                await loadDashboardData();
                showToast('è³‡æ–™å·²åˆ·æ–°', 'æ‰€æœ‰è³‡æ–™å·²é‡æ–°è¼‰å…¥', 'success');
            } catch (error) {
                console.error('åˆ·æ–°å¤±æ•—:', error);
                showToast('åˆ·æ–°å¤±æ•—', 'ç„¡æ³•é‡æ–°è¼‰å…¥è³‡æ–™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š', 'error');
            } finally {
                showLoadingState(false);
            }
        }

        // é‡è©¦é€£ç·š
        async function retryConnection() {
            hideConnectionError();
            await refreshData();
        }

        // æ›´æ–° README
        async function updateReadme() {
            const modal = new bootstrap.Modal(document.getElementById('operationModal'));
            document.getElementById('operationModalTitle').textContent = 'æ›´æ–° README';
            document.getElementById('operationModalBody').innerHTML = `
                <div class="d-flex justify-content-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">æ›´æ–°ä¸­...</span>
                    </div>
                </div>
                <p class="text-center mt-2">æ­£åœ¨æ›´æ–° README.md...</p>
            `;
            modal.show();

            try {
                const response = await fetch('/api/update-readme', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'README æ›´æ–°å¤±æ•—');
                }
                
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> README æ›´æ–°æˆåŠŸï¼
                        <p class="mb-0 mt-2">å·²è‡ªå‹•æ›´æ–°é¡Œç›®é€²åº¦å’Œçµ±è¨ˆè³‡è¨Šã€‚</p>
                    </div>
                `;
                setTimeout(() => modal.hide(), 2000);
                showToast('æ›´æ–°æˆåŠŸ', 'README.md å·²æˆåŠŸæ›´æ–°', 'success');
            } catch (error) {
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> æ›´æ–°å¤±æ•—ï¼š${error.message}
                    </div>
                `;
            }
        }

        // é©—è­‰æ‰€æœ‰é¡Œç›®
        async function validateAllChallenges() {
            const modal = new bootstrap.Modal(document.getElementById('operationModal'));
            document.getElementById('operationModalTitle').textContent = 'é©—è­‰é¡Œç›®';
            document.getElementById('operationModalBody').innerHTML = `
                <div class="d-flex justify-content-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">é©—è­‰ä¸­...</span>
                    </div>
                </div>
                <p class="text-center mt-2">æ­£åœ¨é©—è­‰æ‰€æœ‰é¡Œç›®...</p>
            `;
            modal.show();

            try {
                const response = await fetch('/api/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'é©—è­‰å¤±æ•—');
                }
                
                const { total_challenges, errors, warnings } = result;
                
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> é©—è­‰å®Œæˆï¼
                        <ul class="mb-0 mt-2">
                            <li>æª¢æŸ¥äº† ${total_challenges} å€‹é¡Œç›®</li>
                            <li>ç™¼ç¾ ${errors ? errors.length : 0} å€‹éŒ¯èª¤</li>
                            <li>ç™¼ç¾ ${warnings ? warnings.length : 0} å€‹è­¦å‘Š</li>
                        </ul>
                    </div>
                `;
                setTimeout(() => modal.hide(), 3000);
                showToast('é©—è­‰å®Œæˆ', 'æ‰€æœ‰é¡Œç›®é©—è­‰å®Œæˆ', 'success');
            } catch (error) {
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> é©—è­‰å¤±æ•—ï¼š${error.message}
                    </div>
                `;
            }
        }

        // åŒ¯å‡ºè³‡æ–™
        async function exportData() {
            try {
                const data = challengeData;
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ctf-progress-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('åŒ¯å‡ºæˆåŠŸ', 'è³‡æ–™å·²æˆåŠŸåŒ¯å‡º', 'success');
            } catch (error) {
                showToast('åŒ¯å‡ºå¤±æ•—', error.message, 'error');
            }
        }

        // é¡¯ç¤º Toast é€šçŸ¥
        // é¡¯ç¤ºéµç›¤å¿«é€Ÿéµèªªæ˜
        function showKeyboardHelp() {
            const modal = new bootstrap.Modal(document.getElementById('keyboardHelpModal'));
            modal.show();
        }

        // åˆå§‹åŒ– Tooltips
        function initializeTooltips() {
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(el => new bootstrap.Tooltip(el));
        }

        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = type === 'error' ? 'bg-danger' : `bg-${type}`;
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0`;
            toast.id = toastId;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // è‡ªå‹•ç§»é™¤
            setTimeout(() => {
                if (document.getElementById(toastId)) {
                    toastContainer.removeChild(toast);
                }
            }, 5000);
        }

        // ========== æç¤ºç®¡ç†åŠŸèƒ½ ==========
        
        let currentHintsChallenge = {};
        
        // æ‰“é–‹æç¤ºç®¡ç†å™¨
        async function openHintsManager(rowIndex, cellIndex, title, category, folderName) {
            try {
                // é©—è­‰åƒæ•¸
                if (!category || !folderName || category === 'undefined' || folderName === 'undefined') {
                    throw new Error(`ç„¡æ•ˆçš„åƒæ•¸: category=${category}, folderName=${folderName}`);
                }
                
                currentHintsChallenge = { category, folderName, title };
                
                // è¨­ç½®æ¨¡æ…‹æ¡†æ¨™é¡Œ
                document.getElementById('hintsModalTitle').textContent = `${title} (${category})`;
                
                // è¼‰å…¥ç¾æœ‰æç¤º
                await loadChallengeHints(category, folderName);
                
                // æ¸…ç©ºè¡¨å–®
                document.getElementById('addHintForm').reset();
                
                // é¡¯ç¤ºæ¨¡æ…‹æ¡†
                const modal = new bootstrap.Modal(document.getElementById('hintsModal'));
                modal.show();
            } catch (error) {
                showToast('è¼‰å…¥å¤±æ•—', error.message, 'error');
            }
        }
        
        // è¼‰å…¥é¡Œç›®æç¤º
        async function loadChallengeHints(category, folderName) {
            try {
                const response = await fetch(`/api/challenges/${category}/${folderName}/hints`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'è¼‰å…¥æç¤ºå¤±æ•—');
                }
                
                displayHints(data.hints || []);
            } catch (error) {
                console.error('è¼‰å…¥æç¤ºå¤±æ•—:', error);
                displayHints([]);
            }
        }
        
        // é¡¯ç¤ºæç¤ºåˆ—è¡¨
        function displayHints(hints) {
            const container = document.getElementById('existingHints');
            
            if (hints.length === 0) {
                container.innerHTML = `
                    <div class="list-group-item text-center text-muted">
                        <em>å°šæœªè¨­å®šä»»ä½•æç¤º</em>
                    </div>
                `;
                return;
            }
            
            // æŒ‰ç­‰ç´šæ’åº
            hints.sort((a, b) => (a.level || 0) - (b.level || 0));
            
            const hintsHtml = hints.map(hint => {
                const costColor = hint.cost === 0 ? 'success' : (hint.cost <= 20 ? 'warning' : 'danger');
                return `
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-2">
                                    <h6 class="mb-0 me-2">ğŸ’¡ æç¤º ${hint.level}</h6>
                                    <span class="badge bg-${costColor}">
                                        ${hint.cost === 0 ? 'å…è²»' : `${hint.cost} åˆ†`}
                                    </span>
                                </div>
                                <p class="mb-0">${hint.content}</p>
                            </div>
                            <div class="btn-group btn-group-sm ms-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" 
                                    onclick="editHint(${hint.level}, ${hint.cost}, '${hint.content.replace(/'/g, "\\'")}')">
                                    âœï¸
                                </button>
                                <button type="button" class="btn btn-outline-danger btn-sm"
                                    onclick="deleteHint(${hint.level})">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = hintsHtml;
        }
        
        // æ–°å¢æç¤º
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addHintForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const hintData = {
                    level: parseInt(formData.get('level') || document.getElementById('hintLevel').value),
                    cost: parseInt(formData.get('cost') || document.getElementById('hintCost').value),
                    content: formData.get('content') || document.getElementById('hintContent').value
                };
                
                try {
                    const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(hintData)
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.error || 'æ–°å¢æç¤ºå¤±æ•—');
                    }
                    
                    showToast('æˆåŠŸ', 'æç¤ºæ–°å¢æˆåŠŸ', 'success');
                    
                    // é‡æ–°è¼‰å…¥æç¤ºåˆ—è¡¨
                    await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
                    
                    // æ¸…ç©ºè¡¨å–®
                    e.target.reset();
                } catch (error) {
                    showToast('æ–°å¢å¤±æ•—', error.message, 'error');
                }
            });
        });
        
        // ç·¨è¼¯æç¤º
        function editHint(level, cost, content) {
            document.getElementById('hintLevel').value = level;
            document.getElementById('hintCost').value = cost;
            document.getElementById('hintContent').value = content;
            
            // æ›´æ”¹æŒ‰éˆ•æ–‡å­—å’Œè¡Œç‚º
            const submitBtn = document.querySelector('#addHintForm button[type="submit"]');
            submitBtn.textContent = 'æ›´æ–°æç¤º';
            submitBtn.onclick = () => updateHint(level);
        }
        
        // æ›´æ–°æç¤º
        async function updateHint(level) {
            const hintData = {
                cost: parseInt(document.getElementById('hintCost').value),
                content: document.getElementById('hintContent').value
            };
            
            try {
                const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints/${level}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(hintData)
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'æ›´æ–°æç¤ºå¤±æ•—');
                }
                
                showToast('æˆåŠŸ', 'æç¤ºæ›´æ–°æˆåŠŸ', 'success');
                
                // é‡æ–°è¼‰å…¥æç¤ºåˆ—è¡¨
                await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
                
                // é‡ç½®è¡¨å–®å’ŒæŒ‰éˆ•
                document.getElementById('addHintForm').reset();
                const submitBtn = document.querySelector('#addHintForm button[type="submit"]');
                submitBtn.textContent = 'æ–°å¢æç¤º';
                submitBtn.onclick = null;
            } catch (error) {
                showToast('æ›´æ–°å¤±æ•—', error.message, 'error');
            }
        }
        
        // åˆªé™¤æç¤º
        async function deleteHint(level) {
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤æç¤º ${level} å—ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/challenges/${currentHintsChallenge.category}/${currentHintsChallenge.folderName}/hints/${level}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'åˆªé™¤æç¤ºå¤±æ•—');
                }
                
                showToast('æˆåŠŸ', 'æç¤ºåˆªé™¤æˆåŠŸ', 'success');
                
                // é‡æ–°è¼‰å…¥æç¤ºåˆ—è¡¨
                await loadChallengeHints(currentHintsChallenge.category, currentHintsChallenge.folderName);
            } catch (error) {
                showToast('åˆªé™¤å¤±æ•—', error.message, 'error');
            }
        }
        
        // ç·¨è¼¯é¡Œç›®
        function editChallenge(category, name) {
            if (category && name) {
                showToast('ç·¨è¼¯é¡Œç›®', `ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­ - ${category}/${name}`, 'info');
            } else {
                showToast('ç·¨è¼¯é¡Œç›®', 'ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
            }
        }
        
        // é¡¯ç¤ºé¡Œç›®è©³æƒ…ï¼ˆçµ±ä¸€å‡½æ•¸åç¨±ï¼‰
        async function showChallengeDetails(category, challengeIdentifier) {
            // é©—è­‰åŸºæœ¬åƒæ•¸
            if (!category || category === 'undefined') {
                showToast('éŒ¯èª¤', 'ç„¡æ•ˆçš„é¡Œç›®åˆ†é¡', 'error');
                console.error('Invalid category:', category);
                return;
            }
            
            // è™•ç†ä¸åŒçš„èª¿ç”¨æ–¹å¼
            let folderName = challengeIdentifier;
            
            // å¦‚æœ challengeIdentifier æ˜¯æ•¸å­—ï¼ˆç´¢å¼•ï¼‰ï¼Œå‰‡éœ€è¦æ‰¾åˆ°å°æ‡‰çš„ folderName
            if (typeof challengeIdentifier === 'number') {
                const challenges = challengeData.challenges?.[category];
                if (challenges && challenges[challengeIdentifier]) {
                    folderName = challenges[challengeIdentifier].folder_name;
                } else {
                    showToast('éŒ¯èª¤', 'æ‰¾ä¸åˆ°æŒ‡å®šçš„é¡Œç›®', 'error');
                    return;
                }
            }
            
            // èª¿ç”¨æŸ¥çœ‹è©³æƒ…å‡½æ•¸
            await viewChallenge(category, folderName);
        }
        
        // æŸ¥çœ‹é¡Œç›®è©³æƒ…ï¼ˆä½”ä½ç¬¦å‡½æ•¸ï¼‰
        async function viewChallenge(category, folderName) {
            // é©—è­‰åƒæ•¸
            if (!category || !folderName || category === 'undefined' || folderName === 'undefined') {
                showToast('éŒ¯èª¤', 'ç„¡æ•ˆçš„é¡Œç›®åƒæ•¸', 'error');
                console.error('Invalid parameters:', { category, folderName });
                return;
            }
            
            try {
                // é¡¯ç¤ºæ¨¡æ…‹æ¡†ä¸¦è¼‰å…¥
                const modal = new bootstrap.Modal(document.getElementById('challengeDetailsModal'));
                document.getElementById('challengeDetailsContent').innerHTML = `
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                        </div>
                    </div>
                `;
                modal.show();
                
                // ç²å–é¡Œç›®è©³æƒ…
                const response = await fetch(`/api/challenges/${category}/${folderName}/details`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const challenge = await response.json();
                
                // æ¸²æŸ“é¡Œç›®è©³æƒ…
                renderChallengeDetails(challenge);
                
                // è¨­ç½®æŒ‰éˆ•åŠŸèƒ½
                const hintsBtn = document.getElementById('manageChallengeHintsBtn');
                if (hintsBtn) {
                    hintsBtn.style.display = 'inline-block';
                    hintsBtn.onclick = () => {
                        modal.hide();
                        openHintsManager(0, 0, challenge.title, category, folderName);
                    };
                }
                
                const editBtn = document.getElementById('editChallengeBtn');
                if (editBtn) {
                    editBtn.style.display = 'inline-block';
                    editBtn.onclick = () => {
                        modal.hide();
                        editChallenge(category, folderName);
                    };
                }
                
            } catch (error) {
                console.error('è¼‰å…¥é¡Œç›®è©³æƒ…å¤±æ•—:', error);
                document.getElementById('challengeDetailsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>è¼‰å…¥å¤±æ•—</strong><br>
                        ç„¡æ³•è¼‰å…¥é¡Œç›®è©³æƒ…ï¼š${error.message}
                    </div>
                `;
            }
        }
        
        function renderChallengeDetails(challenge) {
            const difficultyColors = {
                'baby': 'success',
                'easy': 'info', 
                'middle': 'warning',
                'hard': 'danger',
                'impossible': 'dark'
            };
            
            const difficultyIcons = {
                'baby': 'ğŸ¼',
                'easy': 'â­',
                'middle': 'â­â­', 
                'hard': 'â­â­â­',
                'impossible': 'ğŸ’€'
            };
            
            const statusColors = {
                'planning': 'secondary',
                'developing': 'warning',
                'testing': 'info',
                'completed': 'success',
                'deployed': 'primary'
            };
            
            const typeIcons = {
                'nc_challenge': 'ğŸ”Œ',
                'static_container': 'ğŸ³',
                'dynamic_container': 'ğŸ”„',
                'static_attachment': 'ğŸ“',
                'dynamic_attachment': 'ğŸ“‹'
            };
            
            const typeNames = {
                'nc_challenge': 'NC é¡Œç›®',
                'static_container': 'éœæ…‹å®¹å™¨',
                'dynamic_container': 'å‹•æ…‹å®¹å™¨',
                'static_attachment': 'éœæ…‹é™„ä»¶',
                'dynamic_attachment': 'å‹•æ…‹é™„ä»¶'
            };
            
            const difficultyColor = difficultyColors[challenge.difficulty] || 'secondary';
            const difficultyIcon = difficultyIcons[challenge.difficulty] || 'â“';
            const statusColor = statusColors[challenge.status] || 'secondary';
            const statusIcon = getStatusIcon(challenge.status);
            const typeIcon = typeIcons[challenge.challenge_type] || 'ğŸ“';
            const typeName = typeNames[challenge.challenge_type] || challenge.challenge_type;
            
            const hintsHtml = challenge.hints && challenge.hints.length > 0 ? 
                challenge.hints.map(hint => `
                    <div class="alert alert-info alert-sm mb-2">
                        <div class="d-flex justify-content-between">
                            <span><strong>Level ${hint.level}</strong> (${hint.cost} åˆ†)</span>
                        </div>
                        <div class="mt-1">${hint.content}</div>
                    </div>
                `).join('') : '<p class="text-muted">æš«ç„¡æç¤º</p>';
            
            const filesHtml = challenge.files && challenge.files.length > 0
                ? challenge.files.map(file => `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-file-earmark"></i> ${file}</span>
                        <span class="badge bg-primary rounded-pill">æª”æ¡ˆ</span>
                    </li>
                `).join('')
                : '<li class="list-group-item text-muted">ç„¡é™„ä»¶æª”æ¡ˆ</li>';
            
            document.getElementById('challengeDetailsContent').innerHTML = `
                <div class="row">
                    <!-- åŸºæœ¬è³‡è¨Š -->
                    <div class="col-md-8">
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-info-circle"></i> åŸºæœ¬è³‡è¨Š</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-3"><strong>é¡Œç›®åç¨±ï¼š</strong></div>
                                    <div class="col-sm-9">${challenge.title}</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>ä½œè€…ï¼š</strong></div>
                                    <div class="col-sm-9">${challenge.author}</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>åˆ†é¡ï¼š</strong></div>
                                    <div class="col-sm-9">
                                        <span class="badge bg-primary">${challenge.category}</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>é›£åº¦ï¼š</strong></div>
                                    <div class="col-sm-9">
                                        <span class="badge bg-${difficultyColor}">
                                            ${difficultyIcon} ${challenge.difficulty}
                                        </span>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>ç‹€æ…‹ï¼š</strong></div>
                                    <div class="col-sm-9">
                                        <span class="badge bg-${statusColor}">
                                            ${statusIcon} ${challenge.status}
                                        </span>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>åˆ†æ•¸ï¼š</strong></div>
                                    <div class="col-sm-9">${challenge.points} åˆ†</div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>é¡Œç›®é¡å‹ï¼š</strong></div>
                                    <div class="col-sm-9">
                                        <span class="badge bg-info">${challenge.challenge_type || 'æœªè¨­å®š'}</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-sm-3"><strong>å»ºç«‹æ™‚é–“ï¼š</strong></div>
                                    <div class="col-sm-9">${challenge.created_at ? new Date(challenge.created_at).toLocaleDateString('zh-TW') : 'æœªçŸ¥'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- é¡Œç›®æè¿° -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-file-text"></i> é¡Œç›®æè¿°</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-light">
                                    ${challenge.description || 'æš«ç„¡æè¿°'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- é™„ä»¶æª”æ¡ˆ -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-paperclip"></i> é™„ä»¶æª”æ¡ˆ</h5>
                            </div>
                            <div class="card-body p-0">
                                <ul class="list-group list-group-flush">
                                    ${filesHtml}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å´é‚Šæ¬„è³‡è¨Š -->
                    <div class="col-md-4">
                        <!-- éƒ¨ç½²è³‡è¨Š -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-cloud"></i> éƒ¨ç½²è³‡è¨Š</h5>
                            </div>
                            <div class="card-body">
                                ${challenge.deploy_info ? `
                                    <div class="mb-2">
                                        <strong>ç«¯å£ï¼š</strong> ${challenge.deploy_info.port || 'æœªè¨­å®š'}
                                    </div>
                                    <div class="mb-2">
                                        <strong>URLï¼š</strong> ${challenge.deploy_info.url || 'æœªè¨­å®š'}
                                    </div>
                                    <div class="mb-2">
                                        <strong>éœ€è¦å»ºæ§‹ï¼š</strong> ${challenge.deploy_info.requires_build ? 'æ˜¯' : 'å¦'}
                                    </div>
                                    ${challenge.deploy_info.nc_port ? `
                                        <div class="mb-2">
                                            <strong>NC ç«¯å£ï¼š</strong> ${challenge.deploy_info.nc_port}
                                        </div>
                                    ` : ''}
                                    ${challenge.deploy_info.timeout ? `
                                        <div class="mb-2">
                                            <strong>é€£ç·šè¶…æ™‚ï¼š</strong> ${challenge.deploy_info.timeout} ç§’
                                        </div>
                                    ` : ''}
                                ` : '<p class="text-muted">ç„¡éƒ¨ç½²è³‡è¨Š</p>'}
                            </div>
                        </div>
                        
                        <!-- æ¨™ç±¤ -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-tags"></i> æ¨™ç±¤</h5>
                            </div>
                            <div class="card-body">
                                ${challenge.tags && challenge.tags.length > 0 
                                    ? challenge.tags.map(tag => `<span class="badge bg-secondary me-1">${tag}</span>`).join('') 
                                    : '<span class="text-muted">ç„¡æ¨™ç±¤</span>'
                                }
                            </div>
                        </div>
                        
                        <!-- åŸå§‹ç¢¼æä¾› -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="bi bi-code-slash"></i> åŸå§‹ç¢¼</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    ${challenge.source_code_provided 
                                        ? '<i class="bi bi-check-circle text-success me-2"></i><span class="text-success">æä¾›åŸå§‹ç¢¼</span>'
                                        : '<i class="bi bi-x-circle text-danger me-2"></i><span class="text-danger">ä¸æä¾›åŸå§‹ç¢¼</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é¡Œç›®æç¤º -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-lightbulb text-warning"></i> é¡Œç›®æç¤º</h5>
                                <button class="btn btn-sm btn-outline-primary" onclick="document.getElementById('manageChallengeHintsBtn').click()">
                                    <i class="bi bi-gear"></i> ç®¡ç†æç¤º
                                </button>
                            </div>
                            <div class="card-body">
                                ${hintsHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>