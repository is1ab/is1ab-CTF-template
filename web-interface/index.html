<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS1AB CTF ÁÆ°ÁêÜ‰ªãÈù¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <!-- Â∞éËà™Âàó -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-shield-check"></i> IS1AB CTF ÁÆ°ÁêÜ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="bi bi-house"></i> È¶ñÈ†Å
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="create-challenge.html">
                            <i class="bi bi-plus-circle"></i> ÂâµÂª∫È°åÁõÆ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="progress.html">
                            <i class="bi bi-graph-up"></i> ÈÄ≤Â∫¶Êü•Áúã
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-tools"></i> Â∑•ÂÖ∑
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="updateReadme()">
                                <i class="bi bi-file-text"></i> Êõ¥Êñ∞ README
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="validateAllChallenges()">
                                <i class="bi bi-check-square"></i> È©óË≠âÈ°åÁõÆ
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="exportData()">
                                <i class="bi bi-download"></i> ÂåØÂá∫Ë≥áÊñô
                            </a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                            <i class="bi bi-arrow-clockwise"></i> Âà∑Êñ∞
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- È†ÅÈù¢Ê®ôÈ°å -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-6">
                    <i class="bi bi-trophy text-warning"></i> CTF È°åÁõÆÁÆ°ÁêÜ‰∏≠ÂøÉ
                </h1>
                <p class="lead text-muted">ÁÆ°ÁêÜÂíåËøΩËπ§ CTF ÊØîË≥ΩÈ°åÁõÆÁöÑÈñãÁôºÈÄ≤Â∫¶</p>
            </div>
        </div>

        <!-- Áµ±Ë®àÂç°Áâá -->
        <div class="row mb-4" id="statsCards">
            <div class="col-md-3 mb-3">
                <div class="card bg-primary text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">Á∏ΩÈ°åÁõÆÊï∏</h6>
                                <h2 class="mb-0 mt-2" id="totalChallenges">-</h2>
                                <small class="opacity-75">ÂÄãÈ°åÁõÆ</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-collection"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">Â∑≤ÂÆåÊàê</h6>
                                <h2 class="mb-0 mt-2" id="completedChallenges">-</h2>
                                <small class="opacity-75">Â∑≤ÂÆåÂ∑•</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-check-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">ÈñãÁôº‰∏≠</h6>
                                <h2 class="mb-0 mt-2" id="developingChallenges">-</h2>
                                <small class="opacity-75">ÈÄ≤Ë°å‰∏≠</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-tools"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card bg-info text-white h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-0">Â∑≤ÈÉ®ÁΩ≤</h6>
                                <h2 class="mb-0 mt-2" id="deployedChallenges">-</h2>
                                <small class="opacity-75">ÂèØ‰ΩøÁî®</small>
                            </div>
                            <div class="fs-1 opacity-50">
                                <i class="bi bi-cloud-upload"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- È°åÁõÆÈ°ûÂûãÂíåÂéüÂßãÁ¢ºÂàÜÂ∏É -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-pie-chart text-primary"></i> È°åÁõÆÈ°ûÂûãÂàÜÂ∏É</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="typeChart" width="400" height="250"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-bar-chart text-success"></i> Èõ£Â∫¶ & ÂéüÂßãÁ¢ºÂàÜÂ∏É</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <h6>Èõ£Â∫¶ÂàÜÂ∏É</h6>
                                <div id="difficultyBars"></div>
                            </div>
                            <div class="col-12">
                                <h6>ÂéüÂßãÁ¢ºÊèê‰æõÁãÄÊ≥Å</h6>
                                <div class="d-flex justify-content-between">
                                    <div class="text-center">
                                        <div class="fs-3">üìÑ</div>
                                        <div class="fw-bold" id="sourceCodeProvided">-</div>
                                        <small class="text-muted">Êèê‰æõÂéüÂßãÁ¢º</small>
                                    </div>
                                    <div class="text-center">
                                        <div class="fs-3">üîí</div>
                                        <div class="fw-bold" id="sourceCodeNotProvided">-</div>
                                        <small class="text-muted">‰∏çÊèê‰æõÂéüÂßãÁ¢º</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊúÄËøëÊ¥ªÂãïÂíåÂø´ÈÄüÊìç‰Ωú -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history text-info"></i> ÊúÄËøëÊ¥ªÂãï
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="loadRecentActivity()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity" style="max-height: 300px; overflow-y: auto;">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-lightning text-warning"></i> Âø´ÈÄüÊìç‰Ωú</h5>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <button class="btn btn-primary mb-2" onclick="window.location.href='create-challenge.html'">
                            <i class="bi bi-plus-circle"></i> ÂâµÂª∫Êñ∞È°åÁõÆ
                        </button>
                        <button class="btn btn-success mb-2" onclick="updateReadme()">
                            <i class="bi bi-file-text"></i> Êõ¥Êñ∞ README
                        </button>
                        <button class="btn btn-info mb-2" onclick="validateAllChallenges()">
                            <i class="bi bi-check-square"></i> È©óË≠âÊâÄÊúâÈ°åÁõÆ
                        </button>
                        <button class="btn btn-outline-secondary" onclick="window.location.href='progress.html'">
                            <i class="bi bi-graph-up"></i> Êü•ÁúãË©≥Á¥∞ÈÄ≤Â∫¶
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÈÄ≤Â∫¶Ë°®Ê†º -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-table text-primary"></i> È°åÁõÆÈÄ≤Â∫¶‰∏ÄË¶Ω
                        </h5>
                        <div>
                            <button class="btn btn-sm btn-outline-success" onclick="exportData()">
                                <i class="bi bi-download"></i> ÂåØÂá∫
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="loadProgressTable()">
                                <i class="bi bi-arrow-clockwise"></i> Âà∑Êñ∞
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-striped" id="progressTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th style="width: 100px;">ÂàÜÈ°û</th>
                                        <th class="text-center">A</th>
                                        <th class="text-center">B</th>
                                        <th class="text-center">C</th>
                                        <th class="text-center">D</th>
                                        <th class="text-center">E</th>
                                        <th class="text-center">F</th>
                                    </tr>
                                </thead>
                                <tbody id="progressTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Âúñ‰æã -->
                        <div class="mt-3 p-3 bg-light rounded">
                            <h6 class="mb-2">Âúñ‰æãË™™ÊòéÔºö</h6>
                            <div class="row small">
                                <div class="col-md-4">
                                    <div><span class="badge bg-success me-1">‚úÖ</span> Â∑≤ÂÆåÊàê‰∏¶ÈÉ®ÁΩ≤</div>
                                    <div><span class="badge bg-warning me-1">üî®</span> ÈñãÁôº/Ê∏¨Ë©¶‰∏≠</div>
                                    <div><span class="badge bg-secondary me-1">üìù</span> Ë¶èÂäÉ‰∏≠</div>
                                </div>
                                <div class="col-md-4">
                                    <div><span class="badge bg-danger me-1">‚ùå</span> Â∞öÊú™ÈñãÂßã</div>
                                    <div><span class="badge bg-primary me-1">üîå</span> NC È°åÁõÆ</div>
                                    <div><span class="badge bg-info me-1">üê≥</span> ÂÆπÂô®È°åÁõÆ</div>
                                </div>
                                <div class="col-md-4">
                                    <div><span class="badge bg-light text-dark me-1">üìÑ</span> Êèê‰æõÂéüÂßãÁ¢º</div>
                                    <div><span class="badge bg-dark me-1">üîí</span> ‰∏çÊèê‰æõÂéüÂßãÁ¢º</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂúòÈöä‰ªªÂãôÂàÜÈÖç -->
        <div class="row mb-4">
            <div class="col">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-people text-success"></i> ÂúòÈöä‰ªªÂãôÂàÜÈÖç</h5>
                    </div>
                    <div class="card-body">
                        <div id="teamAssignments" class="row">
                            <div class="col-12 text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for operations -->
    <div class="modal fade" id="operationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="operationModalTitle">Êìç‰ΩúÈÄ≤Ë°å‰∏≠</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="operationModalBody">
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">ËôïÁêÜ‰∏≠...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="operationModalFooter">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="api.js"></script>
    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let challengeData = {};
        let typeChart = null;

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            loadProgressTable();
            loadRecentActivity();
            loadTeamAssignments();
        });

        // ËºâÂÖ•ÂÑÄË°®ÊùøË≥áÊñô
        async function loadDashboardData() {
            try {
                const stats = await api.getStats();
                challengeData = stats;
                updateStatsCards(stats);
                updateCharts(stats);
            } catch (error) {
                // ‰ΩøÁî®Ê®°Êì¨Ë≥áÊñô
                challengeData = getMockData();
                updateStatsCards(challengeData.stats);
                updateCharts(challengeData.stats);
                console.log('‰ΩøÁî®Ê®°Êì¨Ë≥áÊñô');
            }
        }

        // Ê®°Êì¨Ë≥áÊñô
        function getMockData() {
            return {
                challenges: {
                    pwn: [
                        { title: "Example Buffer Overflow", status: "planning", difficulty: "baby", source_code_provided: false, challenge_type: "nc_challenge" }
                    ]
                },
                stats: {
                    total_challenges: 1,
                    status_counts: { planning: 1, developing: 0, testing: 0, completed: 0, deployed: 0 },
                    type_counts: { static_attachment: 0, static_container: 0, dynamic_attachment: 0, dynamic_container: 0, nc_challenge: 1 },
                    difficulty_counts: { baby: 1, easy: 0, middle: 0, hard: 0, impossible: 0 },
                    source_code_counts: { provided: 0, not_provided: 1 }
                }
            };
        }

        // Êõ¥Êñ∞Áµ±Ë®àÂç°Áâá
        function updateStatsCards(stats) {
            document.getElementById('totalChallenges').textContent = stats.total_challenges || 0;
            document.getElementById('completedChallenges').textContent = stats.status_counts?.completed || 0;
            document.getElementById('developingChallenges').textContent = stats.status_counts?.developing || 0;
            document.getElementById('deployedChallenges').textContent = stats.status_counts?.deployed || 0;
        }

        // Êõ¥Êñ∞ÂúñË°®
        function updateCharts(stats) {
            // È°åÁõÆÈ°ûÂûãÂúìÈ§ÖÂúñ
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            
            if (typeChart) {
                typeChart.destroy();
            }
            
            typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['üìé ÈùúÊÖãÈôÑ‰ª∂', 'üê≥ ÈùúÊÖãÂÆπÂô®', 'üìã ÂãïÊÖãÈôÑ‰ª∂', 'üîÑ ÂãïÊÖãÂÆπÂô®', 'üîå NC È°åÁõÆ'],
                    datasets: [{
                        data: [
                            stats.type_counts?.static_attachment || 0,
                            stats.type_counts?.static_container || 0,
                            stats.type_counts?.dynamic_attachment || 0,
                            stats.type_counts?.dynamic_container || 0,
                            stats.type_counts?.nc_challenge || 0
                        ],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 10
                            }
                        }
                    }
                }
            });

            // Èõ£Â∫¶ÂàÜÂ∏ÉÊ¢ùÁãÄÂúñ
            updateDifficultyBars(stats);
            
            // ÂéüÂßãÁ¢ºÂàÜÂ∏É
            document.getElementById('sourceCodeProvided').textContent = stats.source_code_counts?.provided || 0;
            document.getElementById('sourceCodeNotProvided').textContent = stats.source_code_counts?.not_provided || 0;
        }

        // Êõ¥Êñ∞Èõ£Â∫¶ÂàÜÂ∏ÉÊ¢ùÁãÄÂúñ
        function updateDifficultyBars(stats) {
            const difficulties = [
                { name: 'üçº Baby', count: stats.difficulty_counts?.baby || 0, color: 'success' },
                { name: '‚≠ê Easy', count: stats.difficulty_counts?.easy || 0, color: 'info' },
                { name: '‚≠ê‚≠ê Middle', count: stats.difficulty_counts?.middle || 0, color: 'warning' },
                { name: '‚≠ê‚≠ê‚≠ê Hard', count: stats.difficulty_counts?.hard || 0, color: 'danger' },
                { name: 'üíÄ Impossible', count: stats.difficulty_counts?.impossible || 0, color: 'dark' }
            ];

            const total = difficulties.reduce((sum, d) => sum + d.count, 0);
            const barsHtml = difficulties.map(d => {
                const percentage = total > 0 ? (d.count / total * 100) : 0;
                return `
                    <div class="d-flex align-items-center mb-1">
                        <div class="me-2" style="width: 80px; font-size: 12px;">${d.name}</div>
                        <div class="flex-grow-1">
                            <div class="progress" style="height: 15px;">
                                <div class="progress-bar bg-${d.color}" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="ms-2 small">${d.count}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('difficultyBars').innerHTML = barsHtml;
        }

        // ËºâÂÖ•ÈÄ≤Â∫¶Ë°®Ê†º
        async function loadProgressTable() {
            try {
                const progress = await api.getProgress();
                updateProgressTable(progress);
            } catch (error) {
                updateProgressTable(challengeData);
            }
        }

        // Êõ¥Êñ∞ÈÄ≤Â∫¶Ë°®Ê†º
        function updateProgressTable(data) {
            const tbody = document.getElementById('progressTableBody');
            const categories = ['general', 'web', 'pwn', 'reverse', 'crypto', 'forensic', 'misc'];
            
            let html = '';
            categories.forEach(category => {
                const challenges = data.challenges?.[category] || [];
                const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
                
                html += `<tr>
                    <td class="fw-bold">${categoryName}</td>`;
                
                for (let i = 0; i < 6; i++) {
                    if (i < challenges.length) {
                        const challenge = challenges[i];
                        const status = challenge.status || 'planning';
                        const challengeType = challenge.challenge_type || 'static_attachment';
                        const sourceCode = challenge.source_code_provided;
                        
                        const statusIcon = getStatusIcon(status);
                        const typeIcon = getTypeIcon(challengeType);
                        const sourceIcon = sourceCode ? 'üìÑ' : 'üîí';
                        
                        html += `<td class="text-center" title="${challenge.title || 'Challenge ' + String.fromCharCode(65 + i)}">
                            <div class="fs-5">${statusIcon}${typeIcon}</div>
                            <small class="text-muted">${sourceIcon}</small>
                        </td>`;
                    } else {
                        html += `<td class="text-center">
                            <div class="fs-5 text-muted">‚ùå</div>
                        </td>`;
                    }
                }
                
                html += '</tr>';
            });
            
            tbody.innerHTML = html;
        }

        // ÂèñÂæóÁãÄÊÖãÂúñÁ§∫
        function getStatusIcon(status) {
            const icons = {
                'planning': 'üìù',
                'developing': 'üî®',
                'testing': 'üß™',
                'completed': '‚úÖ',
                'deployed': 'üöÄ'
            };
            return icons[status] || '‚ùì';
        }

        // ÂèñÂæóÈ°ûÂûãÂúñÁ§∫
        function getTypeIcon(challengeType) {
            const icons = {
                'nc_challenge': 'üîå',
                'static_container': 'üê≥',
                'dynamic_container': 'üîÑ',
                'static_attachment': 'üìé',
                'dynamic_attachment': 'üìã'
            };
            return icons[challengeType] || '';
        }

        // ËºâÂÖ•ÊúÄËøëÊ¥ªÂãï
        async function loadRecentActivity() {
            const activityDiv = document.getElementById('recentActivity');
            try {
                const activities = await api.getRecentActivity();
                if (activities && activities.length > 0) {
                    activityDiv.innerHTML = activities.map(activity => `
                        <div class="d-flex align-items-start mb-3 p-2 border-start border-3 border-${activity.type === 'commit' ? 'primary' : 'success'}">
                            <div class="badge bg-${activity.type === 'commit' ? 'primary' : 'success'} me-3 mt-1">
                                <i class="bi bi-${activity.type === 'commit' ? 'git' : 'check'}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="fw-bold mb-1">${activity.message}</div>
                                <small class="text-muted">
                                    <i class="bi bi-person"></i> ${activity.author} ‚Ä¢ 
                                    <i class="bi bi-clock"></i> ${activity.time}
                                </small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    activityDiv.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                            <p>Êö´ÁÑ°ÊúÄËøëÊ¥ªÂãï</p>
                        </div>`;
                }
            } catch (error) {
                activityDiv.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-clock-history fs-1 d-block mb-2"></i>
                        <p>ÊúÄËøëÂª∫Á´ã‰∫ÜÁØÑ‰æã PWN È°åÁõÆ</p>
                        <small class="text-muted">Example Buffer Overflow ‚Ä¢ GZTime</small>
                    </div>`;
            }
        }

        // ËºâÂÖ•ÂúòÈöä‰ªªÂãôÂàÜÈÖç
        async function loadTeamAssignments() {
            const assignmentsDiv = document.getElementById('teamAssignments');
            try {
                const assignments = await api.getTeamAssignments();
                if (assignments && Object.keys(assignments).length > 0) {
                    let html = '';
                    Object.entries(assignments).forEach(([author, tasks]) => {
                        html += `
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">
                                            <i class="bi bi-person-circle"></i> ${author}
                                        </h6>
                                    </div>
                                    <div class="card-body p-3">
                        `;
                        
                        tasks.forEach(task => {
                            const statusColor = getStatusColor(task.status);
                            const sourceIcon = task.source_code_provided ? 'üìÑ' : 'üîí';
                            const typeIcon = getTypeIcon(task.challenge_type);
                            
                            html += `
                                <div class="d-flex align-items-center mb-2 p-2 border rounded">
                                    <div class="badge bg-${statusColor} me-2">${getStatusIcon(task.status)}</div>
                                    <div class="flex-grow-1">
                                        <div class="fw-bold small">${task.category}/${task.title}</div>
                                        <small class="text-muted">${task.difficulty} ${typeIcon} ${sourceIcon}</small>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    assignmentsDiv.innerHTML = html;
                } else {
                    assignmentsDiv.innerHTML = `
                        <div class="col-12 text-center py-4">
                            <i class="bi bi-people fs-1 text-muted d-block mb-2"></i>
                            <p class="text-muted">Êö´ÁÑ°‰ªªÂãôÂàÜÈÖç</p>
                        </div>`;
                }
            } catch (error) {
                // ‰ΩøÁî®Ê®°Êì¨Ë≥áÊñô
                assignmentsDiv.innerHTML = `
                    <div class="col-md-6 col-lg-4">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="bi bi-person-circle"></i> GZTime
                                </h6>
                            </div>
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center mb-2 p-2 border rounded">
                                    <div class="badge bg-secondary me-2">üìù</div>
                                    <div class="flex-grow-1">
                                        <div class="fw-bold small">pwn/Example Buffer Overflow</div>
                                        <small class="text-muted">baby üîå üîí</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ÂèñÂæóÁãÄÊÖãÂ∞çÊáâÈ°èËâ≤
        function getStatusColor(status) {
            const colors = {
                'planning': 'secondary',
                'developing': 'warning',
                'testing': 'info',
                'completed': 'success',
                'deployed': 'primary'
            };
            return colors[status] || 'secondary';
        }

        // Âà∑Êñ∞ÊâÄÊúâË≥áÊñô
        function refreshData() {
            loadDashboardData();
            loadProgressTable();
            loadRecentActivity();
            loadTeamAssignments();
            showToast('Ë≥áÊñôÂ∑≤Âà∑Êñ∞', 'ÊâÄÊúâË≥áÊñôÂ∑≤ÈáçÊñ∞ËºâÂÖ•', 'success');
        }

        // Êõ¥Êñ∞ README
        async function updateReadme() {
            const modal = new bootstrap.Modal(document.getElementById('operationModal'));
            document.getElementById('operationModalTitle').textContent = 'Êõ¥Êñ∞ README';
            document.getElementById('operationModalBody').innerHTML = `
                <div class="d-flex justify-content-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Êõ¥Êñ∞‰∏≠...</span>
                    </div>
                </div>
                <p class="text-center mt-2">Ê≠£Âú®Êõ¥Êñ∞ README.md...</p>
            `;
            modal.show();

            try {
                // Ê®°Êì¨ API ÂëºÂè´
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> README Êõ¥Êñ∞ÊàêÂäüÔºÅ
                        <p class="mb-0 mt-2">Â∑≤Ëá™ÂãïÊõ¥Êñ∞È°åÁõÆÈÄ≤Â∫¶ÂíåÁµ±Ë®àË≥áË®ä„ÄÇ</p>
                    </div>
                `;
                setTimeout(() => modal.hide(), 2000);
                showToast('Êõ¥Êñ∞ÊàêÂäü', 'README.md Â∑≤ÊàêÂäüÊõ¥Êñ∞', 'success');
            } catch (error) {
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> Êõ¥Êñ∞Â§±ÊïóÔºö${error.message}
                    </div>
                `;
            }
        }

        // È©óË≠âÊâÄÊúâÈ°åÁõÆ
        async function validateAllChallenges() {
            const modal = new bootstrap.Modal(document.getElementById('operationModal'));
            document.getElementById('operationModalTitle').textContent = 'È©óË≠âÈ°åÁõÆ';
            document.getElementById('operationModalBody').innerHTML = `
                <div class="d-flex justify-content-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">È©óË≠â‰∏≠...</span>
                    </div>
                </div>
                <p class="text-center mt-2">Ê≠£Âú®È©óË≠âÊâÄÊúâÈ°åÁõÆ...</p>
            `;
            modal.show();

            try {
                // Ê®°Êì¨ API ÂëºÂè´
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> È©óË≠âÂÆåÊàêÔºÅ
                        <ul class="mb-0 mt-2">
                            <li>Ê™¢Êü•‰∫Ü 1 ÂÄãÈ°åÁõÆ</li>
                            <li>ÁôºÁèæ 0 ÂÄãÈåØË™§</li>
                            <li>ÁôºÁèæ 1 ÂÄãË≠¶ÂëäÔºàÁº∫Â∞ëÂØ¶Èöõ flagÔºâ</li>
                        </ul>
                    </div>
                `;
                setTimeout(() => modal.hide(), 3000);
                showToast('È©óË≠âÂÆåÊàê', 'ÊâÄÊúâÈ°åÁõÆÈ©óË≠âÂÆåÊàê', 'success');
            } catch (error) {
                document.getElementById('operationModalBody').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> È©óË≠âÂ§±ÊïóÔºö${error.message}
                    </div>
                `;
            }
        }

        // ÂåØÂá∫Ë≥áÊñô
        async function exportData() {
            try {
                const data = challengeData;
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ctf-progress-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('ÂåØÂá∫ÊàêÂäü', 'Ë≥áÊñôÂ∑≤ÊàêÂäüÂåØÂá∫', 'success');
            } catch (error) {
                showToast('ÂåØÂá∫Â§±Êïó', error.message, 'error');
            }
        }

        // È°ØÁ§∫ Toast ÈÄöÁü•
        function showToast(title, message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = type === 'error' ? 'bg-danger' : `bg-${type}`;
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0`;
            toast.id = toastId;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Ëá™ÂãïÁßªÈô§
            setTimeout(() => {
                if (document.getElementById(toastId)) {
                    toastContainer.removeChild(toast);
                }
            }, 5000);
        }
    </script>
</body>
</html>